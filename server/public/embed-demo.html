<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Identity Verification - Documentation & Demo</title>
    <style>
        body {
            font-family: system-ui, Segoe UI, Roboto, Arial;
            margin: 0;
            padding: 20px;
            background: #f7fafc;
            position: relative;
        }

        .main-container {
            display: flex;
            max-width: 1200px;
            margin: 0 auto;
            gap: 20px;
        }

        .wrap {
            flex: 1;
            max-width: 980px;
        }

        .sidebar {
            width: 200px;
            position: sticky;
            top: 20px;
            height: fit-content;
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .sidebar h4 {
            margin: 0 0 12px 0;
            font-size: 14px;
            font-weight: 600;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 8px;
        }

        .sidebar-nav {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .sidebar-nav li {
            margin: 4px 0;
        }

        .sidebar-nav a {
            display: block;
            padding: 6px 8px;
            text-decoration: none;
            color: #6b7280;
            font-size: 13px;
            border-radius: 4px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .sidebar-nav a:hover {
            background: #f3f4f6;
            color: #374151;
        }

        .sidebar-nav a.active {
            background: #dbeafe;
            color: #1d4ed8;
            font-weight: 500;
        }

        .sidebar-nav .section {
            font-weight: 500;
            color: #374151;
            padding-left: 0;
        }

        .sidebar-nav .subsection {
            padding-left: 16px;
            font-size: 12px;
        }
        
        .sidebar-nav .subsections {
            margin: 0.25rem 0;
            padding: 0;
            list-style: none;
        }
        
        .sidebar-nav .sub-subsection {
            color: #9ca3af;
            font-size: 11px;
            padding-left: 32px;
        }
        
        .sidebar-nav .sub-subsection:hover {
            color: #3b82f6;
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                position: relative;
                width: 100%;
                order: -1;
            }
            
            .sidebar-nav {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .sidebar-nav li {
                margin: 0;
            }
        }

        .controls {
            display: flex;
            gap: 8px;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap
        }

        .controls label {
            display: flex;
            align-items: center;
            gap: 6px
        }

        .controls input[type="text"],
        .controls input[type="url"],
        .controls select {
            box-sizing: border-box
        }

        .iframe-wrap {
            height: 560px;
            border: 1px solid #e2e8f0;
            background: white
        }

        .panel {
            margin-top: 12px;
            padding: 12px;
            background: #fff;
            border: 1px solid #e2e8f0;
            border-radius: 6px
        }

        pre {
            white-space: pre-wrap
        }

        button {
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #cbd5e1;
            background: #1d4ed8;
            color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        button:hover {
            background: #1e40af;
            transform: translateY(-1px);
        }

        .btn-success {
            background: #10b981 !important;
        }

        .btn-success:hover {
            background: #059669 !important;
        }

        .btn-danger {
            background: #ef4444 !important;
        }

        .btn-danger:hover {
            background: #dc2626 !important;
        }

        .docs-section {
            background: #f8fafc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border-left: 4px solid #1d4ed8;
        }

        .docs-section h2 {
            margin-top: 0;
            color: #1f2937;
        }

        .code-block {
            background: #1f2937;
            color: #e5e7eb;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 12px 0;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            position: relative;
        }

        .code-block.with-lines {
            padding-left: 60px;
        }

        .code-block .line-numbers {
            position: absolute;
            left: 0;
            top: 16px;
            bottom: 16px;
            width: 50px;
            background: #0f172a;
            border-right: 1px solid #374151;
            padding: 0 8px;
            font-size: 12px;
            color: #6b7280;
            line-height: 1.5;
            user-select: none;
            display: flex;
            flex-direction: column;
        }

        .code-block .code-content {
            line-height: 1.5;
            white-space: pre;
            overflow-x: auto;
        }

        .api-endpoint {
            background: #ecfdf5;
            border: 1px solid #10b981;
            padding: 8px 12px;
            border-radius: 4px;
            font-family: monospace;
            color: #065f46;
            margin: 8px 0;
        }

        .parameter {
            background: #fff7ed;
            border: 1px solid #f59e0b;
            padding: 6px 8px;
            border-radius: 4px;
            font-family: monospace;
            color: #92400e;
            font-size: 12px;
        }

        .nav-tabs {
            display: flex;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 20px;
        }

        .nav-tab {
            padding: 12px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #6b7280;
            font-weight: 500;
        }

        .nav-tab.active {
            color: #1d4ed8;
            border-bottom: 2px solid #1d4ed8;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .info-card {
            background: #eff6ff;
            border: 1px solid #3b82f6;
            border-radius: 6px;
            padding: 16px;
            margin: 12px 0;
        }

        .warning-card {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 6px;
            padding: 16px;
            margin: 12px 0;
        }

        .success-card {
            background: #ecfdf5;
            border: 1px solid #10b981;
            border-radius: 6px;
            padding: 16px;
            margin: 12px 0;
        }

        .live-api-grid {
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 16px; 
            margin: 16px 0;
        }

        .api-log-section h4 {
            margin: 0 0 8px 0; 
            display: flex; 
            align-items: center; 
            gap: 8px;
        }

        .api-log-box {
            height: 200px; 
            overflow-y: auto; 
            font-size: 12px;
            line-height: 1.4;
        }

        .api-log-entry {
            border-bottom: 1px solid #374151; 
            padding: 8px 0; 
            margin-bottom: 8px;
        }

        .api-timestamp {
            font-weight: bold;
            margin-bottom: 4px;
        }

        .api-data {
            margin-top: 4px; 
            padding-left: 12px; 
            font-family: 'Courier New', monospace;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .live-controls {
            display: flex; 
            gap: 12px; 
            align-items: center; 
            margin-top: 12px; 
            padding: 12px;
            background: #f8fafc;
            border-radius: 6px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @media (max-width: 768px) {
            .live-api-grid {
                grid-template-columns: 1fr;
            }
            
            .live-controls {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
        }

        /* Responsive tweaks */
        @media (max-width: 900px) {
            .wrap {
                padding: 0 12px
            }

            .iframe-wrap {
                height: 420px
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 12px
            }

            .controls {
                gap: 10px
            }

            .controls label {
                width: 100%;
                margin: 0
            }

            .controls input,
            .controls select {
                width: 100%;
                padding: 8px
            }

            .controls button {
                width: 100%;
                margin-top: 6px
            }

            .iframe-wrap {
                height: 320px
            }

            .panel {
                padding: 10px
            }

            #embedModal>div {
                width: 100%;
                height: 100%;
                border-radius: 0
            }

            #modalFrameArea {
                height: calc(100vh - 56px)
            }
        }
    </style>
</head>

<body>
    <div class="main-container">
        <div class="wrap">
            <h1>Identity Verification - Documentation & Demo</h1>
        
        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('demo')">Live Demo</button>
            <button class="nav-tab" onclick="showTab('api')">API Documentation</button>
            <button class="nav-tab" onclick="showTab('integration')">Integration Guide</button>
            <button class="nav-tab" onclick="showTab('examples')">Code Examples</button>
        </div>

        <!-- Demo Tab -->
        <div id="demo-tab" class="tab-content active">
            <h2 id="demo">Live Demo</h2>
            <p>Creates a verification session, embeds the identity camera iframe, and listens for extracted fields via postMessage.</p>

            <!-- Live API Usage Section -->
            <div class="docs-section" style="margin-bottom: 20px;">
                <h3>üî¥ Live API Usage</h3>
                <p>Dynamic API payload based on your form selections:</p>
                
                <!-- Dynamic Payload Preview -->
                <div class="info-card" style="margin-bottom: 16px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <h4 style="margin: 0; color: #1d4ed8;">üìã Current API Payload</h4>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="toggleCurlCommand()" style="font-size: 11px; padding: 4px 8px; background: #6366f1; border: none; color: white; border-radius: 4px; cursor: pointer;">
                                üîß Show cURL
                            </button>
                            <button onclick="showPayloadExamples()" style="font-size: 11px; padding: 4px 8px; background: #8b5cf6; border: none; color: white; border-radius: 4px; cursor: pointer;">
                                üìö Examples
                            </button>
                        </div>
                    </div>
                    <div id="dynamicPayload" class="code-block" style="margin: 8px 0; font-size: 13px;">
                        <div style="color: #9ca3af; font-style: italic;">Select options below to see dynamic payload</div>
                    </div>
                    <div id="curlCommand" class="code-block" style="margin: 8px 0; font-size: 12px; display: none; background: #0f172a;">
                        <!-- cURL command will be inserted here -->
                    </div>
                    <div style="font-size: 12px; color: #6b7280; margin-top: 8px;">
                        üí° This payload updates automatically as you change form values
                    </div>
                </div>
                
                <div class="live-api-grid">
                    <div class="api-log-section">
                        <h4 style="color: #059669;">
                            üì§ API Requests
                            <div class="status-indicator"></div>
                        </h4>
                        <div id="liveRequests" class="code-block api-log-box">
                            <div style="color: #9ca3af; font-style: italic;">No requests yet - click "Create & Embed" to see API calls</div>
                        </div>
                    </div>
                    <div class="api-log-section">
                        <h4 style="color: #3b82f6;">
                            üì• API Responses  
                            <div class="status-indicator"></div>
                        </h4>
                        <div id="liveResponses" class="code-block api-log-box">
                            <div style="color: #9ca3af; font-style: italic;">No responses yet - responses will appear here</div>
                        </div>
                    </div>
                </div>
                
                <div class="live-controls">
                    <button id="clearApiLogs" onclick="clearApiLogs()" class="btn-danger" style="font-size: 12px; padding: 6px 12px;">
                        üóëÔ∏è Clear Logs
                    </button>
                    <button id="copyPayload" onclick="copyCurrentPayload()" class="btn-success" style="font-size: 12px; padding: 6px 12px;">
                        üìã Copy Payload
                    </button>
                    <label style="display: flex; align-items: center; gap: 6px; font-size: 14px;">
                        <input type="checkbox" id="autoScroll" checked>
                        ‚¨áÔ∏è Auto-scroll to latest
                    </label>
                    <label style="display: flex; align-items: center; gap: 6px; font-size: 14px;">
                        <input type="checkbox" id="timestampToggle" checked>
                        üïê Show timestamps
                    </label>
                    <span style="font-size: 12px; color: #6b7280; display: flex; align-items: center; gap: 4px;">
                        <div class="status-indicator"></div>
                        Live API monitoring enabled
                    </span>
                </div>
            </div>

        <div class="controls">
            <label>Frontend base (optional): <input id="frontendBase" placeholder="http://localhost:5173"
                    style="width:300px;padding:6px;border-radius:6px;border:1px solid #cbd5e1" /></label>
            <label style="margin-left:8px">ID Type: <select id="demoIdType"
                    style="padding:6px;border-radius:6px;border:1px solid #cbd5e1;margin-left:6px">
                    <option value="national-id">National ID</option>
                    <option value="passport">Passport</option>
                    <option value="umid">UMID</option>
                </select></label>
            <label style="margin-left:8px">Mode: <select id="testModeSelect"
                    style="padding:6px;border-radius:6px;border:1px solid #cbd5e1;margin-left:6px">
                    <option value="camera">Camera Mode</option>
                    <option value="test">Test Mode</option>
                </select></label>
            <label style="margin-left:8px">Success Url: <input id="successWebhook"
                    placeholder="https://example.com/webhook/success"
                    style="width:300px;padding:6px;border-radius:6px;border:1px solid #cbd5e1;margin-left:6px" /></label>
            <label style="margin-left:8px">Cancel Url: <input id="cancelWebhook"
                    placeholder="https://example.com/webhook/cancel"
                    style="width:300px;padding:6px;border-radius:6px;border:1px solid #cbd5e1;margin-left:6px" /></label>
            <button id="createBtn">Create & Embed</button>
            <!-- <button id="openWrapper" style="background:#10b981">Open Wrapper</button> -->
            <button id="pushResult" style="background:#ef4444">Push Result</button>
        </div>
        <!-- Modal for near-fullscreen iframe -->
        <div id="embedModal"
            style="display:none; position:fixed; inset:0; background:rgba(2,6,23,0.75); align-items:center; justify-content:center; z-index:9999;">
            <div
                style="position:relative; width:96%; max-width:1200px; height:92%; background:white; border-radius:8px; overflow:hidden; display:flex; flex-direction:column;">
                <div
                    style="flex:0 0 48px; display:flex; align-items:center; justify-content:space-between; padding:8px 12px; background:#0f172a; color:white;">
                    <div>Identity Embed (modal)</div>
                    <div style="display:flex; gap:8px; align-items:center;">
                        <button id="modalClose"
                            style="background:transparent;border:0;color:white;font-size:18px;cursor:pointer;">‚úï</button>
                    </div>
                </div>
                <div id="modalFrameArea" style="flex:1; background:#000; display:flex;">
                    <!-- iframe will be injected here -->
                </div>
            </div>
        </div>

            <div class="panel">
                <h3>Session Info</h3>
                <div id="sessionInfo">No session yet</div>
            </div>

            <div class="panel">
                <h3>Received Messages</h3>
                <div id="messages"><em>None</em></div>
            </div>
        </div>

        <!-- API Documentation Tab -->
        <div id="api-tab" class="tab-content">
            <div class="docs-section">
                <h2 id="api">Identity Verification API</h2>
                <p>The Identity Verification service provides secure document scanning and data extraction capabilities through both camera-based and test modes.</p>
                
                <div class="info-card">
                    <strong>Base URL:</strong> <span class="api-endpoint">http://localhost:3000</span>
                </div>

                <h3 id="api-endpoints">Embed Integration</h3>
                <div class="api-endpoint">GET /embed</div>
                <p>Renders the identity verification interface in an embeddable iframe.</p>
                
                <h4 id="api-parameters">Query Parameters</h4>
                <ul>
                    <li><span class="parameter">testMode</span> (boolean) - Enable test mode to skip camera and use mock data</li>
                    <li><span class="parameter">sessionId</span> (string) - Optional session identifier for tracking</li>
                </ul>

                <div class="code-block">
&lt;iframe 
    src="http://localhost:3000/embed?testMode=false" 
    width="100%" 
    height="600"
    frameborder="0"&gt;
&lt;/iframe&gt;
                </div>

                <h3 id="api-responses">Response Format</h3>
                <p>Both camera and test modes return consistent identity data:</p>
                <div class="code-block">
{
  "success": true,
  "data": {
    "firstName": "John",
    "lastName": "Doe", 
    "idNumber": "1234567890",
    "birthDate": "1990-01-15",
    "confidence": 0.95
  },
  "mode": "camera" | "test"
}
                </div>

                <h3>Mobile Features</h3>
                <div class="success-card">
                    <strong>Automatic Mobile Support:</strong> The system detects mobile devices and provides rotation controls for optimal camera positioning.
                </div>
                <ul>
                    <li>Portrait/Landscape rotation toggle (0¬∞ ‚Üî 90¬∞)</li>
                    <li>Touch-friendly interface</li>
                    <li>Responsive design</li>
                    <li>Automatic device detection</li>
                </ul>
            </div>
        </div>

        <!-- Integration Guide Tab -->
        <div id="integration-tab" class="tab-content">
            <div class="docs-section">
                <h2 id="integration">Integration Guide</h2>
                
                <h3 id="quick-start">1. Basic Iframe Integration</h3>
                <p>The simplest way to integrate the identity verification system:</p>
                <div class="code-block">
&lt;iframe 
    id="identity-frame"
    src="http://localhost:3000/embed" 
    width="100%" 
    height="600"
    frameborder="0"&gt;
&lt;/iframe&gt;
                </div>

                <h3 id="iframe-embedding">2. Listening for Results</h3>
                <p>Handle verification results using the postMessage API:</p>
                <div class="code-block">
window.addEventListener('message', function(event) {
    if (event.origin !== 'http://localhost:3000') return;
    
    if (event.data.type === 'IDENTITY_VERIFIED') {
        const identityData = event.data.data;
        console.log('Verification complete:', identityData);
        
        // Process the identity data
        handleVerificationResult(identityData);
    }
});
                </div>

                <h3 id="postmessage-api">3. Test Mode Integration</h3>
                <div class="warning-card">
                    <strong>Note:</strong> Test mode should only be used in development environments. It bypasses camera capture and returns mock data.
                </div>
                
                <div class="code-block">
// Enable test mode
const testModeUrl = 'http://localhost:3000/embed?testMode=true';
document.getElementById('identity-frame').src = testModeUrl;
                </div>

                <h3>4. Mobile Considerations</h3>
                <div class="success-card">
                    <strong>Mobile Support:</strong> The system automatically detects mobile devices and provides rotation controls for optimal camera positioning.
                </div>
                
                <ul>
                    <li>Automatic mobile detection</li>
                    <li>Portrait/Landscape rotation toggle</li>
                    <li>Touch-friendly interface</li>
                    <li>Responsive design</li>
                </ul>

                <h3>5. Error Handling</h3>
                <div class="code-block">
window.addEventListener('message', function(event) {
    if (event.origin !== 'http://localhost:3000') return;
    
    switch(event.data.type) {
        case 'IDENTITY_VERIFIED':
            handleSuccess(event.data.data);
            break;
        case 'VERIFICATION_ERROR':
            handleError(event.data.error);
            break;
        case 'USER_CANCELLED':
            handleCancellation();
            break;
    }
});
                </div>
            </div>
        </div>

        <!-- Code Examples Tab -->
        <div id="examples-tab" class="tab-content">
            <div class="docs-section">
                <h2 id="examples">Code Examples</h2>
                
                <h3 id="react-example">React Integration</h3>
                <p>Complete React component with TypeScript support, hooks, and error handling:</p>
                
                <!-- Basic React Component -->
                <h4 id="react-basic-component">Basic React Component</h4>
                <div class="code-block with-lines">
                    <div class="line-numbers">
                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                        <div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div>
                        <div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div>
                        <div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div>
                        <div>111</div><div>112</div><div>113</div><div>114</div><div>115</div><div>116</div><div>117</div><div>118</div><div>119</div><div>120</div>
                        <div>121</div><div>122</div><div>123</div><div>124</div><div>125</div>
                    </div>
                    <div class="code-content">
<span style="color: #c792ea;">import</span> <span style="color: #82aaff;">React</span>, { 
  <span style="color: #82aaff;">useEffect</span>, 
  <span style="color: #82aaff;">useRef</span>, 
  <span style="color: #82aaff;">useState</span>, 
  <span style="color: #82aaff;">useCallback</span> 
} <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'react'</span>;

<span style="color: #7c7c7c;">// TypeScript interface for identity data</span>
<span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">IdentityData</span> {
  <span style="color: #82aaff;">firstName</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">lastName</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">idNumber</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">birthDate</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">confidence</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">phone_number</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">id_type</span>: <span style="color: #c3e88d;">'national-id'</span> | <span style="color: #c3e88d;">'passport'</span> | <span style="color: #c3e88d;">'umid'</span>;
  <span style="color: #82aaff;">action</span>: <span style="color: #c3e88d;">'success'</span> | <span style="color: #c3e88d;">'cancel'</span>;
}

<span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">IdentityVerificationProps</span> {
  <span style="color: #82aaff;">testMode</span>?: <span style="color: #c792ea;">boolean</span>;
  <span style="color: #82aaff;">sessionId</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">idType</span>?: <span style="color: #c3e88d;">'national-id'</span> | <span style="color: #c3e88d;">'passport'</span> | <span style="color: #c3e88d;">'umid'</span>;
  <span style="color: #82aaff;">baseUrl</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">onResult</span>: (<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>) => <span style="color: #c792ea;">void</span>;
  <span style="color: #82aaff;">onError</span>?: (<span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span>) => <span style="color: #c792ea;">void</span>;
  <span style="color: #82aaff;">onCancel</span>?: () => <span style="color: #c792ea;">void</span>;
}

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">IdentityVerification</span>: <span style="color: #ffcb6b;">React.FC</span>&lt;<span style="color: #ffcb6b;">IdentityVerificationProps</span>&gt; = ({
  <span style="color: #82aaff;">testMode</span> = <span style="color: #f78c6c;">false</span>,
  <span style="color: #82aaff;">sessionId</span>,
  <span style="color: #82aaff;">idType</span> = <span style="color: #c3e88d;">'national-id'</span>,
  <span style="color: #82aaff;">baseUrl</span> = <span style="color: #c3e88d;">'http://localhost:3000'</span>,
  <span style="color: #82aaff;">onResult</span>,
  <span style="color: #82aaff;">onError</span>,
  <span style="color: #82aaff;">onCancel</span>
}) => {
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">iframeRef</span> = <span style="color: #82aaff;">useRef</span>&lt;<span style="color: #ffcb6b;">HTMLIFrameElement</span>&gt;(<span style="color: #f78c6c;">null</span>);
  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">isLoading</span>, <span style="color: #82aaff;">setIsLoading</span>] = <span style="color: #82aaff;">useState</span>(<span style="color: #f78c6c;">true</span>);
  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">error</span>, <span style="color: #82aaff;">setError</span>] = <span style="color: #82aaff;">useState</span>&lt;<span style="color: #c792ea;">string</span> | <span style="color: #c792ea;">null</span>&gt;(<span style="color: #f78c6c;">null</span>);

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleMessage</span> = <span style="color: #82aaff;">useCallback</span>((<span style="color: #82aaff;">event</span>: <span style="color: #ffcb6b;">MessageEvent</span>) => {
    <span style="color: #7c7c7c;">// Security check - validate origin</span>
    <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">origin</span> !== <span style="color: #82aaff;">baseUrl</span>) <span style="color: #c792ea;">return</span>;
    
    <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">message</span> = <span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">data</span>;
    <span style="color: #c792ea;">if</span> (!<span style="color: #82aaff;">message</span>.<span style="color: #82aaff;">identityOCR</span>) <span style="color: #c792ea;">return</span>;

    <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">action</span>, <span style="color: #82aaff;">result</span> } = <span style="color: #82aaff;">message</span>.<span style="color: #82aaff;">identityOCR</span>;
    
    <span style="color: #c792ea;">switch</span> (<span style="color: #82aaff;">action</span>) {
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'success'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #82aaff;">setError</span>(<span style="color: #f78c6c;">null</span>);
        <span style="color: #82aaff;">onResult</span>(<span style="color: #82aaff;">result</span>);
        <span style="color: #c792ea;">break</span>;
      
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'error'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #82aaff;">setError</span>(<span style="color: #82aaff;">result</span>.<span style="color: #82aaff;">error</span> || <span style="color: #c3e88d;">'Verification failed'</span>);
        <span style="color: #82aaff;">onError</span>?.(<span style="color: #82aaff;">result</span>.<span style="color: #82aaff;">error</span>);
        <span style="color: #c792ea;">break</span>;
      
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'cancel'</span>:
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'close'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #82aaff;">onCancel</span>?.();
        <span style="color: #c792ea;">break</span>;
        
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'test_auth_complete'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">result</span>.<span style="color: #82aaff;">authorized</span>) {
          <span style="color: #82aaff;">onResult</span>(<span style="color: #82aaff;">result</span>);
        } <span style="color: #c792ea;">else</span> {
          <span style="color: #82aaff;">onCancel</span>?.();
        }
        <span style="color: #c792ea;">break</span>;
    }
  }, [<span style="color: #82aaff;">baseUrl</span>, <span style="color: #82aaff;">onResult</span>, <span style="color: #82aaff;">onError</span>, <span style="color: #82aaff;">onCancel</span>]);

  <span style="color: #82aaff;">useEffect</span>(() => {
    <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">addEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #82aaff;">handleMessage</span>);
    <span style="color: #c792ea;">return</span> () => <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">removeEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #82aaff;">handleMessage</span>);
  }, [<span style="color: #82aaff;">handleMessage</span>]);

  <span style="color: #7c7c7c;">// Configure iframe for dynamic ID type</span>
  <span style="color: #82aaff;">useEffect</span>(() => {
    <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">iframeRef</span>.<span style="color: #82aaff;">current</span>) {
      <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">configMessage</span> = {
        <span style="color: #82aaff;">identityOCR</span>: { <span style="color: #82aaff;">action</span>: <span style="color: #c3e88d;">'configure'</span>, <span style="color: #82aaff;">idType</span> }
      };
      <span style="color: #82aaff;">iframeRef</span>.<span style="color: #82aaff;">current</span>.<span style="color: #82aaff;">contentWindow</span>?.<span style="color: #82aaff;">postMessage</span>(<span style="color: #82aaff;">configMessage</span>, <span style="color: #82aaff;">baseUrl</span>);
    }
  }, [<span style="color: #82aaff;">idType</span>, <span style="color: #82aaff;">baseUrl</span>]);

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">embedUrl</span> = <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">URL</span>(
    <span style="color: #82aaff;">sessionId</span> ? <span style="color: #c3e88d;">`/embed/session/${sessionId}`</span> : <span style="color: #c3e88d;">'/embed-demo'</span>, 
    <span style="color: #82aaff;">baseUrl</span>
  );
  <span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'testMode'</span>, <span style="color: #82aaff;">testMode</span>.<span style="color: #82aaff;">toString</span>());
  <span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'expectedOrigin'</span>, <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">location</span>.<span style="color: #82aaff;">origin</span>);

  <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">error</span>) {
    <span style="color: #c792ea;">return</span> (
      &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"identity-verification-error"</span>&gt;
        &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">style</span>={{
          <span style="color: #82aaff;">color</span>: <span style="color: #c3e88d;">'#ef4444'</span>, 
          <span style="color: #82aaff;">padding</span>: <span style="color: #c3e88d;">'16px'</span>,
          <span style="color: #82aaff;">border</span>: <span style="color: #c3e88d;">'1px solid #fecaca'</span>,
          <span style="color: #82aaff;">borderRadius</span>: <span style="color: #c3e88d;">'8px'</span>,
          <span style="color: #82aaff;">backgroundColor</span>: <span style="color: #c3e88d;">'#fef2f2'</span>
        }}&gt;
          <span style="color: #7c7c7c;">‚ùå Error: {error}</span>
          &lt;<span style="color: #f07178;">button</span> 
            <span style="color: #c792ea;">onClick</span>={() => { <span style="color: #82aaff;">setError</span>(<span style="color: #f78c6c;">null</span>); <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">true</span>); }}
            <span style="color: #c792ea;">style</span>={{
              <span style="color: #82aaff;">marginLeft</span>: <span style="color: #c3e88d;">'8px'</span>,
              <span style="color: #82aaff;">padding</span>: <span style="color: #c3e88d;">'4px 8px'</span>,
              <span style="color: #82aaff;">backgroundColor</span>: <span style="color: #c3e88d;">'#3b82f6'</span>,
              <span style="color: #82aaff;">color</span>: <span style="color: #c3e88d;">'white'</span>,
              <span style="color: #82aaff;">border</span>: <span style="color: #c3e88d;">'none'</span>,
              <span style="color: #82aaff;">borderRadius</span>: <span style="color: #c3e88d;">'4px'</span>,
              <span style="color: #82aaff;">cursor</span>: <span style="color: #c3e88d;">'pointer'</span>
            }}
          &gt;
            Retry
          &lt;/<span style="color: #f07178;">button</span>&gt;
        &lt;/<span style="color: #f07178;">div</span>&gt;
      &lt;/<span style="color: #f07178;">div</span>&gt;
    );
  }

  <span style="color: #c792ea;">return</span> (
    &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"identity-verification"</span>&gt;
      {<span style="color: #82aaff;">isLoading</span> && (
        &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"loading-indicator"</span> <span style="color: #c792ea;">style</span>={{
          <span style="color: #82aaff;">position</span>: <span style="color: #c3e88d;">'absolute'</span>,
          <span style="color: #82aaff;">top</span>: <span style="color: #c3e88d;">'50%'</span>,
          <span style="color: #82aaff;">left</span>: <span style="color: #c3e88d;">'50%'</span>,
          <span style="color: #82aaff;">transform</span>: <span style="color: #c3e88d;">'translate(-50%, -50%)'</span>,
          <span style="color: #82aaff;">zIndex</span>: <span style="color: #f78c6c;">1000</span>
        }}&gt;
          &lt;<span style="color: #f07178;">div</span>&gt;üîÑ Loading verification...&lt;/<span style="color: #f07178;">div</span>&gt;
        &lt;/<span style="color: #f07178;">div</span>&gt;
      )}
      &lt;<span style="color: #f07178;">iframe</span>
        <span style="color: #c792ea;">ref</span>={<span style="color: #82aaff;">iframeRef</span>}
        <span style="color: #c792ea;">src</span>={<span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">toString</span>()}
        <span style="color: #c792ea;">width</span>=<span style="color: #c3e88d;">"100%"</span>
        <span style="color: #c792ea;">height</span>=<span style="color: #c3e88d;">"600"</span>
        <span style="color: #c792ea;">frameBorder</span>=<span style="color: #c3e88d;">"0"</span>
        <span style="color: #c792ea;">title</span>=<span style="color: #c3e88d;">"Identity Verification"</span>
        <span style="color: #c792ea;">allow</span>=<span style="color: #c3e88d;">"camera; microphone"</span>
        <span style="color: #c792ea;">onLoad</span>={() => <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>)}
        <span style="color: #c792ea;">style</span>={{ <span style="color: #82aaff;">border</span>: <span style="color: #c3e88d;">'1px solid #e5e7eb'</span>, <span style="color: #82aaff;">borderRadius</span>: <span style="color: #c3e88d;">'8px'</span> }}
      /&gt;
    &lt;/<span style="color: #f07178;">div</span>&gt;
  );
};

<span style="color: #c792ea;">export default</span> <span style="color: #82aaff;">IdentityVerification</span>;
                    </div>
                </div>

                <!-- React Hook Example -->
                <h4 id="react-custom-hook">Custom React Hook</h4>
                <p>Reusable hook for identity verification across multiple components:</p>
                <div class="code-block with-lines">
                    <div class="line-numbers">
                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                        <div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div>
                    </div>
                    <div class="code-content">
<span style="color: #7c7c7c;">// useIdentityVerification.ts</span>
<span style="color: #c792ea;">import</span> { <span style="color: #82aaff;">useState</span>, <span style="color: #82aaff;">useCallback</span>, <span style="color: #82aaff;">useRef</span> } <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'react'</span>;

<span style="color: #c792ea;">export</span> <span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">VerificationConfig</span> {
  <span style="color: #82aaff;">baseUrl</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">testMode</span>?: <span style="color: #c792ea;">boolean</span>;
  <span style="color: #82aaff;">idType</span>?: <span style="color: #c3e88d;">'national-id'</span> | <span style="color: #c3e88d;">'passport'</span> | <span style="color: #c3e88d;">'umid'</span>;
}

<span style="color: #c792ea;">export</span> <span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">VerificationState</span> {
  <span style="color: #82aaff;">isLoading</span>: <span style="color: #c792ea;">boolean</span>;
  <span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span> | <span style="color: #c792ea;">null</span>;
  <span style="color: #82aaff;">result</span>: <span style="color: #ffcb6b;">IdentityData</span> | <span style="color: #c792ea;">null</span>;
  <span style="color: #82aaff;">sessionId</span>: <span style="color: #c792ea;">string</span> | <span style="color: #c792ea;">null</span>;
}

<span style="color: #c792ea;">export</span> <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">useIdentityVerification</span> = (<span style="color: #82aaff;">config</span>: <span style="color: #ffcb6b;">VerificationConfig</span> = {}) => {
  <span style="color: #c792ea;">const</span> {
    <span style="color: #82aaff;">baseUrl</span> = <span style="color: #c3e88d;">'http://localhost:3000'</span>,
    <span style="color: #82aaff;">testMode</span> = <span style="color: #f78c6c;">false</span>,
    <span style="color: #82aaff;">idType</span> = <span style="color: #c3e88d;">'national-id'</span>
  } = <span style="color: #82aaff;">config</span>;

  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">state</span>, <span style="color: #82aaff;">setState</span>] = <span style="color: #82aaff;">useState</span>&lt;<span style="color: #ffcb6b;">VerificationState</span>&gt;({
    <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">false</span>,
    <span style="color: #82aaff;">error</span>: <span style="color: #f78c6c;">null</span>,
    <span style="color: #82aaff;">result</span>: <span style="color: #f78c6c;">null</span>,
    <span style="color: #82aaff;">sessionId</span>: <span style="color: #f78c6c;">null</span>
  });

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">abortControllerRef</span> = <span style="color: #82aaff;">useRef</span>&lt;<span style="color: #ffcb6b;">AbortController</span> | <span style="color: #c792ea;">null</span>&gt;(<span style="color: #f78c6c;">null</span>);

  <span style="color: #7c7c7c;">// Create verification session</span>
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">createSession</span> = <span style="color: #82aaff;">useCallback</span>(<span style="color: #c792ea;">async</span> (<span style="color: #82aaff;">payload</span> = {}) => {
    <span style="color: #82aaff;">setState</span>(<span style="color: #82aaff;">prev</span> => ({ ...<span style="color: #82aaff;">prev</span>, <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">true</span>, <span style="color: #82aaff;">error</span>: <span style="color: #f78c6c;">null</span> }));
    
    <span style="color: #c792ea;">try</span> {
      <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">response</span> = <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">fetch</span>(<span style="color: #c3e88d;">`${baseUrl}/api/verify/create`</span>, {
        <span style="color: #82aaff;">method</span>: <span style="color: #c3e88d;">'POST'</span>,
        <span style="color: #82aaff;">headers</span>: { <span style="color: #c3e88d;">'Content-Type'</span>: <span style="color: #c3e88d;">'application/json'</span> },
        <span style="color: #82aaff;">body</span>: <span style="color: #ffcb6b;">JSON</span>.<span style="color: #82aaff;">stringify</span>({
          <span style="color: #82aaff;">testMode</span>,
          <span style="color: #82aaff;">idType</span>,
          <span style="color: #82aaff;">origin</span>: <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">location</span>.<span style="color: #82aaff;">origin</span>,
          ...<span style="color: #82aaff;">payload</span>
        })
      });
      
      <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">data</span> = <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">response</span>.<span style="color: #82aaff;">json</span>();
      
      <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">success</span>) {
        <span style="color: #82aaff;">setState</span>(<span style="color: #82aaff;">prev</span> => ({ 
          ...<span style="color: #82aaff;">prev</span>, 
          <span style="color: #82aaff;">sessionId</span>: <span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">sessionId</span>, 
          <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">false</span> 
        }));
        <span style="color: #c792ea;">return</span> <span style="color: #82aaff;">data</span>;
      } <span style="color: #c792ea;">else</span> {
        <span style="color: #c792ea;">throw</span> <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">Error</span>(<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">error</span> || <span style="color: #c3e88d;">'Failed to create session'</span>);
      }
    } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
      <span style="color: #82aaff;">setState</span>(<span style="color: #82aaff;">prev</span> => ({ 
        ...<span style="color: #82aaff;">prev</span>, 
        <span style="color: #82aaff;">error</span>: <span style="color: #82aaff;">error</span> <span style="color: #c792ea;">instanceof</span> <span style="color: #ffcb6b;">Error</span> ? <span style="color: #82aaff;">error</span>.<span style="color: #82aaff;">message</span> : <span style="color: #c3e88d;">'Unknown error'</span>,
        <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">false</span> 
      }));
      <span style="color: #c792ea;">throw</span> <span style="color: #82aaff;">error</span>;
    }
  }, [<span style="color: #82aaff;">baseUrl</span>, <span style="color: #82aaff;">testMode</span>, <span style="color: #82aaff;">idType</span>]);

  <span style="color: #7c7c7c;">// Get session status</span>
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">getSessionStatus</span> = <span style="color: #82aaff;">useCallback</span>(<span style="color: #c792ea;">async</span> (<span style="color: #82aaff;">sessionId</span>: <span style="color: #c792ea;">string</span>) => {
    <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">response</span> = <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">fetch</span>(<span style="color: #c3e88d;">`${baseUrl}/api/verify/session/${sessionId}`</span>);
    <span style="color: #c792ea;">return</span> <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">response</span>.<span style="color: #82aaff;">json</span>();
  }, [<span style="color: #82aaff;">baseUrl</span>]);

  <span style="color: #7c7c7c;">// Reset state</span>
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">reset</span> = <span style="color: #82aaff;">useCallback</span>(() => {
    <span style="color: #82aaff;">abortControllerRef</span>.<span style="color: #82aaff;">current</span>?.<span style="color: #82aaff;">abort</span>();
    <span style="color: #82aaff;">setState</span>({
      <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">false</span>,
      <span style="color: #82aaff;">error</span>: <span style="color: #f78c6c;">null</span>,
      <span style="color: #82aaff;">result</span>: <span style="color: #f78c6c;">null</span>,
      <span style="color: #82aaff;">sessionId</span>: <span style="color: #f78c6c;">null</span>
    });
  }, []);

  <span style="color: #7c7c7c;">// Handle verification result</span>
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleResult</span> = <span style="color: #82aaff;">useCallback</span>((<span style="color: #82aaff;">result</span>: <span style="color: #ffcb6b;">IdentityData</span>) => {
    <span style="color: #82aaff;">setState</span>(<span style="color: #82aaff;">prev</span> => ({ ...<span style="color: #82aaff;">prev</span>, <span style="color: #82aaff;">result</span>, <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">false</span>, <span style="color: #82aaff;">error</span>: <span style="color: #f78c6c;">null</span> }));
  }, []);

  <span style="color: #7c7c7c;">// Handle verification error</span>
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleError</span> = <span style="color: #82aaff;">useCallback</span>((<span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span>) => {
    <span style="color: #82aaff;">setState</span>(<span style="color: #82aaff;">prev</span> => ({ ...<span style="color: #82aaff;">prev</span>, <span style="color: #82aaff;">error</span>, <span style="color: #82aaff;">isLoading</span>: <span style="color: #f78c6c;">false</span> }));
  }, []);

  <span style="color: #c792ea;">return</span> {
    ...state,
    <span style="color: #82aaff;">createSession</span>,
    <span style="color: #82aaff;">getSessionStatus</span>,
    <span style="color: #82aaff;">reset</span>,
    <span style="color: #82aaff;">handleResult</span>,
    <span style="color: #82aaff;">handleError</span>
  };
};
                    </div>
                </div>

                <!-- React Usage Example -->
                <h4 id="react-usage-example">Complete Usage Example</h4>
                <p>Example React app using the identity verification component and hook:</p>
                <div class="code-block with-lines">
                    <div class="line-numbers">
                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                        <div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div>
                    </div>
                    <div class="code-content">
<span style="color: #7c7c7c;">// App.tsx</span>
<span style="color: #c792ea;">import</span> <span style="color: #82aaff;">React</span>, { <span style="color: #82aaff;">useState</span> } <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'react'</span>;
<span style="color: #c792ea;">import</span> <span style="color: #82aaff;">IdentityVerification</span> <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'./components/IdentityVerification'</span>;
<span style="color: #c792ea;">import</span> { <span style="color: #82aaff;">useIdentityVerification</span>, <span style="color: #ffcb6b;">IdentityData</span> } <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'./hooks/useIdentityVerification'</span>;

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">App</span>: <span style="color: #ffcb6b;">React.FC</span> = () => {
  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">activeTab</span>, <span style="color: #82aaff;">setActiveTab</span>] = <span style="color: #82aaff;">useState</span>(<span style="color: #c3e88d;">'component'</span>);
  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">verificationData</span>, <span style="color: #82aaff;">setVerificationData</span>] = <span style="color: #82aaff;">useState</span>&lt;<span style="color: #ffcb6b;">IdentityData</span> | <span style="color: #c792ea;">null</span>&gt;(<span style="color: #f78c6c;">null</span>);
  
  <span style="color: #7c7c7c;">// Using the custom hook</span>
  <span style="color: #c792ea;">const</span> {
    <span style="color: #82aaff;">isLoading</span>,
    <span style="color: #82aaff;">error</span>,
    <span style="color: #82aaff;">result</span>,
    <span style="color: #82aaff;">sessionId</span>,
    <span style="color: #82aaff;">createSession</span>,
    <span style="color: #82aaff;">reset</span>,
    <span style="color: #82aaff;">handleResult</span>,
    <span style="color: #82aaff;">handleError</span>
  } = <span style="color: #82aaff;">useIdentityVerification</span>({
    <span style="color: #82aaff;">testMode</span>: <span style="color: #f78c6c;">true</span>,
    <span style="color: #82aaff;">idType</span>: <span style="color: #c3e88d;">'national-id'</span>
  });

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleVerificationResult</span> = (<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>) => {
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'‚úÖ Verification successful:'</span>, <span style="color: #82aaff;">data</span>);
    <span style="color: #82aaff;">setVerificationData</span>(<span style="color: #82aaff;">data</span>);
    <span style="color: #82aaff;">handleResult</span>(<span style="color: #82aaff;">data</span>);
    
    <span style="color: #7c7c7c;">// Process the verified identity data</span>
    <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">action</span> === <span style="color: #c3e88d;">'success'</span>) {
      <span style="color: #7c7c7c;">// Send to your backend, save to database, etc.</span>
      <span style="color: #82aaff;">submitToBackend</span>(<span style="color: #82aaff;">data</span>);
    }
  };

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleVerificationError</span> = (<span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span>) => {
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'‚ùå Verification error:'</span>, <span style="color: #82aaff;">error</span>);
    <span style="color: #82aaff;">handleError</span>(<span style="color: #82aaff;">error</span>);
    <span style="color: #7c7c7c;">// Handle error - show notification, log to analytics, etc.</span>
  };

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleCancel</span> = () => {
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üö´ Verification cancelled'</span>);
    <span style="color: #7c7c7c;">// Handle cancellation - redirect, show message, etc.</span>
  };

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">submitToBackend</span> = <span style="color: #c792ea;">async</span> (<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>) => {
    <span style="color: #c792ea;">try</span> {
      <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">response</span> = <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">fetch</span>(<span style="color: #c3e88d;">'/api/users/verify-identity'</span>, {
        <span style="color: #82aaff;">method</span>: <span style="color: #c3e88d;">'POST'</span>,
        <span style="color: #82aaff;">headers</span>: { <span style="color: #c3e88d;">'Content-Type'</span>: <span style="color: #c3e88d;">'application/json'</span> },
        <span style="color: #82aaff;">body</span>: <span style="color: #ffcb6b;">JSON</span>.<span style="color: #82aaff;">stringify</span>(<span style="color: #82aaff;">data</span>)
      });
      
      <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">response</span>.<span style="color: #82aaff;">ok</span>) {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'Identity data saved successfully'</span>);
      }
    } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
      <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'Failed to save identity data:'</span>, <span style="color: #82aaff;">error</span>);
    }
  };

  <span style="color: #c792ea;">return</span> (
    &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"app"</span>&gt;
      &lt;<span style="color: #f07178;">h1</span>&gt;Identity Verification Demo&lt;/<span style="color: #f07178;">h1</span>&gt;
      
      <span style="color: #7c7c7c;">{/* Tab Navigation */}</span>
      &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"tabs"</span>&gt;
        &lt;<span style="color: #f07178;">button</span> 
          <span style="color: #c792ea;">onClick</span>={() => <span style="color: #82aaff;">setActiveTab</span>(<span style="color: #c3e88d;">'component'</span>)}
          <span style="color: #c792ea;">className</span>={<span style="color: #82aaff;">activeTab</span> === <span style="color: #c3e88d;">'component'</span> ? <span style="color: #c3e88d;">'active'</span> : <span style="color: #c3e88d;">''</span>}
        &gt;
          Component Demo
        &lt;/<span style="color: #f07178;">button</span>&gt;
        &lt;<span style="color: #f07178;">button</span> 
          <span style="color: #c792ea;">onClick</span>={() => <span style="color: #82aaff;">setActiveTab</span>(<span style="color: #c3e88d;">'hook'</span>)}
          <span style="color: #c792ea;">className</span>={<span style="color: #82aaff;">activeTab</span> === <span style="color: #c3e88d;">'hook'</span> ? <span style="color: #c3e88d;">'active'</span> : <span style="color: #c3e88d;">''</span>}
        &gt;
          Hook Demo
        &lt;/<span style="color: #f07178;">button</span>&gt;
      &lt;/<span style="color: #f07178;">div</span>&gt;

      {<span style="color: #82aaff;">activeTab</span> === <span style="color: #c3e88d;">'component'</span> && (
        &lt;<span style="color: #f07178;">div</span>&gt;
          &lt;<span style="color: #f07178;">h2</span>&gt;React Component Integration&lt;/<span style="color: #f07178;">h2</span>&gt;
          &lt;<span style="color: #f07178;">IdentityVerification</span>
            <span style="color: #c792ea;">testMode</span>={<span style="color: #f78c6c;">true</span>}
            <span style="color: #c792ea;">idType</span>=<span style="color: #c3e88d;">"national-id"</span>
            <span style="color: #c792ea;">onResult</span>={<span style="color: #82aaff;">handleVerificationResult</span>}
            <span style="color: #c792ea;">onError</span>={<span style="color: #82aaff;">handleVerificationError</span>}
            <span style="color: #c792ea;">onCancel</span>={<span style="color: #82aaff;">handleCancel</span>}
          /&gt;
          
          {<span style="color: #82aaff;">verificationData</span> && (
            &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"result"</span>&gt;
              &lt;<span style="color: #f07178;">h3</span>&gt;Verification Result:&lt;/<span style="color: #f07178;">h3</span>&gt;
              &lt;<span style="color: #f07178;">pre</span>&gt;{<span style="color: #ffcb6b;">JSON</span>.<span style="color: #82aaff;">stringify</span>(<span style="color: #82aaff;">verificationData</span>, <span style="color: #f78c6c;">null</span>, <span style="color: #f78c6c;">2</span>)}&lt;/<span style="color: #f07178;">pre</span>&gt;
            &lt;/<span style="color: #f07178;">div</span>&gt;
          )}
        &lt;/<span style="color: #f07178;">div</span>&gt;
      )}

      {<span style="color: #82aaff;">activeTab</span> === <span style="color: #c3e88d;">'hook'</span> && (
        &lt;<span style="color: #f07178;">div</span>&gt;
          &lt;<span style="color: #f07178;">h2</span>&gt;Custom Hook Integration&lt;/<span style="color: #f07178;">h2</span>&gt;
          &lt;<span style="color: #f07178;">button</span> <span style="color: #c792ea;">onClick</span>={<span style="color: #82aaff;">createSession</span>} <span style="color: #c792ea;">disabled</span>={<span style="color: #82aaff;">isLoading</span>}&gt;
            Create Verification Session
          &lt;/<span style="color: #f07178;">button</span>&gt;
          &lt;<span style="color: #f07178;">button</span> <span style="color: #c792ea;">onClick</span>={<span style="color: #82aaff;">reset</span>}&gt;Reset&lt;/<span style="color: #f07178;">button</span>&gt;
          
          {<span style="color: #82aaff;">isLoading</span> && &lt;<span style="color: #f07178;">p</span>&gt;Loading...&lt;/<span style="color: #f07178;">p</span>&gt;}
          {<span style="color: #82aaff;">error</span> && &lt;<span style="color: #f07178;">p</span> <span style="color: #c792ea;">style</span>={{<span style="color: #82aaff;">color</span>: <span style="color: #c3e88d;">'red'</span>}}&gt;Error: {<span style="color: #82aaff;">error</span>}&lt;/<span style="color: #f07178;">p</span>&gt;}
          {<span style="color: #82aaff;">result</span> && &lt;<span style="color: #f07178;">pre</span>&gt;{<span style="color: #ffcb6b;">JSON</span>.<span style="color: #82aaff;">stringify</span>(<span style="color: #82aaff;">result</span>, <span style="color: #f78c6c;">null</span>, <span style="color: #f78c6c;">2</span>)}&lt;/<span style="color: #f07178;">pre</span>&gt;}
          {<span style="color: #82aaff;">sessionId</span> && &lt;<span style="color: #f07178;">p</span>&gt;Session ID: {<span style="color: #82aaff;">sessionId</span>}&lt;/<span style="color: #f07178;">p</span>&gt;}
        &lt;/<span style="color: #f07178;">div</span>&gt;
      )}
    &lt;/<span style="color: #f07178;">div</span>&gt;
  );
};

<span style="color: #c792ea;">export default</span> <span style="color: #82aaff;">App</span>;
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                    </div>
                    <div class="code-content">
<span style="color: #c792ea;">import</span> <span style="color: #82aaff;">React</span>, { 
  <span style="color: #82aaff;">useEffect</span>, 
  <span style="color: #82aaff;">useRef</span>, 
  <span style="color: #82aaff;">useState</span>, 
  <span style="color: #82aaff;">useCallback</span> 
} <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'react'</span>;

<span style="color: #7c7c7c;">// TypeScript interface for identity data</span>
<span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">IdentityData</span> {
  <span style="color: #82aaff;">firstName</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">lastName</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">idNumber</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">birthDate</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">confidence</span>: <span style="color: #c792ea;">number</span>;
  <span style="color: #82aaff;">phone_number</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">id_type</span>: <span style="color: #c3e88d;">'national-id'</span> | <span style="color: #c3e88d;">'passport'</span> | <span style="color: #c3e88d;">'umid'</span>;
  <span style="color: #82aaff;">action</span>: <span style="color: #c3e88d;">'success'</span> | <span style="color: #c3e88d;">'cancel'</span>;
}

<span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">IdentityVerificationProps</span> {
  <span style="color: #82aaff;">testMode</span>?: <span style="color: #c792ea;">boolean</span>;
  <span style="color: #82aaff;">sessionId</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">onResult</span>: (<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>) => <span style="color: #c792ea;">void</span>;
  <span style="color: #82aaff;">onError</span>?: (<span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span>) => <span style="color: #c792ea;">void</span>;
  <span style="color: #82aaff;">onCancel</span>?: () => <span style="color: #c792ea;">void</span>;
}

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">IdentityVerification</span>: <span style="color: #ffcb6b;">React.FC</span>&lt;<span style="color: #ffcb6b;">IdentityVerificationProps</span>&gt; = ({
  <span style="color: #82aaff;">testMode</span> = <span style="color: #f78c6c;">false</span>,
  <span style="color: #82aaff;">sessionId</span>,
  <span style="color: #82aaff;">onResult</span>,
  <span style="color: #82aaff;">onError</span>,
  <span style="color: #82aaff;">onCancel</span>
}) => {
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">iframeRef</span> = <span style="color: #82aaff;">useRef</span>&lt;<span style="color: #ffcb6b;">HTMLIFrameElement</span>&gt;(<span style="color: #f78c6c;">null</span>);
  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">isLoading</span>, <span style="color: #82aaff;">setIsLoading</span>] = <span style="color: #82aaff;">useState</span>(<span style="color: #f78c6c;">true</span>);
  <span style="color: #c792ea;">const</span> [<span style="color: #82aaff;">error</span>, <span style="color: #82aaff;">setError</span>] = <span style="color: #82aaff;">useState</span>&lt;<span style="color: #c792ea;">string</span> | <span style="color: #c792ea;">null</span>&gt;(<span style="color: #f78c6c;">null</span>);

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleMessage</span> = <span style="color: #82aaff;">useCallback</span>((<span style="color: #82aaff;">event</span>: <span style="color: #ffcb6b;">MessageEvent</span>) => {
    <span style="color: #7c7c7c;">// Security check - only accept messages from our domain</span>
    <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">origin</span> !== <span style="color: #c3e88d;">'http://localhost:3000'</span>) <span style="color: #c792ea;">return</span>;
    
    <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">type</span>, <span style="color: #82aaff;">data</span> } = <span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">data</span>;
    
    <span style="color: #c792ea;">switch</span> (<span style="color: #82aaff;">type</span>) {
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'IDENTITY_VERIFIED'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #82aaff;">setError</span>(<span style="color: #f78c6c;">null</span>);
        <span style="color: #82aaff;">onResult</span>(<span style="color: #82aaff;">data</span>);
        <span style="color: #c792ea;">break</span>;
      
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'VERIFICATION_ERROR'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #82aaff;">setError</span>(<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">error</span> || <span style="color: #c3e88d;">'Verification failed'</span>);
        <span style="color: #82aaff;">onError</span>?.(<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">error</span>);
        <span style="color: #c792ea;">break</span>;
      
      <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'USER_CANCELLED'</span>:
        <span style="color: #82aaff;">setIsLoading</span>(<span style="color: #f78c6c;">false</span>);
        <span style="color: #82aaff;">onCancel</span>?.();
        <span style="color: #c792ea;">break</span>;
    }
  }, [<span style="color: #82aaff;">onResult</span>, <span style="color: #82aaff;">onError</span>, <span style="color: #82aaff;">onCancel</span>]);

  <span style="color: #82aaff;">useEffect</span>(() => {
    <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">addEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #82aaff;">handleMessage</span>);
    <span style="color: #c792ea;">return</span> () => <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">removeEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #82aaff;">handleMessage</span>);
  }, [<span style="color: #82aaff;">handleMessage</span>]);

  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">embedUrl</span> = <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">URL</span>(<span style="color: #c3e88d;">'/embed'</span>, <span style="color: #c3e88d;">'http://localhost:3000'</span>);
  <span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'testMode'</span>, <span style="color: #82aaff;">testMode</span>.<span style="color: #82aaff;">toString</span>());
  <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">sessionId</span>) <span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'sessionId'</span>, <span style="color: #82aaff;">sessionId</span>);

  <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">error</span>) {
    <span style="color: #c792ea;">return</span> (
      &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"identity-verification-error"</span>&gt;
        &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">style</span>={{ <span style="color: #82aaff;">color</span>: <span style="color: #c3e88d;">'#ef4444'</span>, <span style="color: #82aaff;">padding</span>: <span style="color: #c3e88d;">'16px'</span> }}&gt;
          <span style="color: #7c7c7c;">‚ùå Error: {error}</span>
        &lt;/<span style="color: #f07178;">div</span>&gt;
      &lt;/<span style="color: #f07178;">div</span>&gt;
    );
  }

  <span style="color: #c792ea;">return</span> (
    &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"identity-verification"</span>&gt;
      {<span style="color: #82aaff;">isLoading</span> && (
        &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">className</span>=<span style="color: #c3e88d;">"loading-indicator"</span>&gt;
          &lt;<span style="color: #f07178;">div</span>&gt;üîÑ Loading verification...&lt;/<span style="color: #f07178;">div</span>&gt;
        &lt;/<span style="color: #f07178;">div</span>&gt;
      )}
      &lt;<span style="color: #f07178;">iframe</span>
        <span style="color: #c792ea;">ref</span>={<span style="color: #82aaff;">iframeRef</span>}
        <span style="color: #c792ea;">src</span>={<span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">toString</span>()}
        <span style="color: #c792ea;">width</span>=<span style="color: #c3e88d;">"100%"</span>
        <span style="color: #c792ea;">height</span>=<span style="color: #c3e88d;">"600"</span>
        <span style="color: #c792ea;">frameBorder</span>=<span style="color: #c3e88d;">"0"</span>
        <span style="color: #c792ea;">title</span>=<span style="color: #c3e88d;">"Identity Verification"</span>
        <span style="color: #c792ea;">allow</span>=<span style="color: #c3e88d;">"camera; microphone"</span>
      /&gt;
    &lt;/<span style="color: #f07178;">div</span>&gt;
  );
};

<span style="color: #c792ea;">export default</span> <span style="color: #82aaff;">IdentityVerification</span>;

<span style="color: #7c7c7c;">// Usage Example:</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">App</span> = () => {
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleVerificationResult</span> = (<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>) => {
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'Verification successful:'</span>, <span style="color: #82aaff;">data</span>);
    <span style="color: #7c7c7c;">// Handle successful verification</span>
  };

  <span style="color: #c792ea;">return</span> (
    &lt;<span style="color: #f07178;">IdentityVerification</span>
      <span style="color: #c792ea;">testMode</span>={<span style="color: #f78c6c;">false</span>}
      <span style="color: #c792ea;">onResult</span>={<span style="color: #82aaff;">handleVerificationResult</span>}
      <span style="color: #c792ea;">onError</span>={(<span style="color: #82aaff;">error</span>) => <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'Verification error:'</span>, <span style="color: #82aaff;">error</span>)}
      <span style="color: #c792ea;">onCancel</span>={() => <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'Verification cancelled'</span>)}
    /&gt;
  );
};
                    </div>
                </div>

                <h3 id="vue-example">Vue.js 3 Integration</h3>
                <p>Complete Vue 3 component with Composition API and TypeScript:</p>
                <div class="code-block with-lines">
                    <div class="line-numbers">
                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                        <div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div>
                        <div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div>
                        <div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div>
                    </div>
                    <div class="code-content">
<span style="color: #7c7c7c;">&lt;!-- IdentityVerification.vue --&gt;</span>
&lt;<span style="color: #f07178;">template</span>&gt;
  &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">class</span>=<span style="color: #c3e88d;">"identity-verification"</span>&gt;
    <span style="color: #7c7c7c;">&lt;!-- Loading State --&gt;</span>
    &lt;<span style="color: #f07178;">div</span> 
      <span style="color: #c792ea;">v-if</span>=<span style="color: #c3e88d;">"isLoading"</span> 
      <span style="color: #c792ea;">class</span>=<span style="color: #c3e88d;">"loading-overlay"</span>
    &gt;
      &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">class</span>=<span style="color: #c3e88d;">"loading-content"</span>&gt;
        &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">class</span>=<span style="color: #c3e88d;">"spinner"</span>&gt;üîÑ&lt;/<span style="color: #f07178;">div</span>&gt;
        &lt;<span style="color: #f07178;">p</span>&gt;Loading identity verification...&lt;/<span style="color: #f07178;">p</span>&gt;
      &lt;/<span style="color: #f07178;">div</span>&gt;
    &lt;/<span style="color: #f07178;">div</span>&gt;

    <span style="color: #7c7c7c;">&lt;!-- Error State --&gt;</span>
    &lt;<span style="color: #f07178;">div</span> 
      <span style="color: #c792ea;">v-if</span>=<span style="color: #c3e88d;">"error"</span> 
      <span style="color: #c792ea;">class</span>=<span style="color: #c3e88d;">"error-state"</span>
    &gt;
      &lt;<span style="color: #f07178;">div</span> <span style="color: #c792ea;">class</span>=<span style="color: #c3e88d;">"error-content"</span>&gt;
        &lt;<span style="color: #f07178;">div</span>&gt;‚ùå {{ <span style="color: #82aaff;">error</span> }}&lt;/<span style="color: #f07178;">div</span>&gt;
        &lt;<span style="color: #f07178;">button</span> <span style="color: #c792ea;">@click</span>=<span style="color: #c3e88d;">"retry"</span>&gt;üîÑ Retry&lt;/<span style="color: #f07178;">button</span>&gt;
      &lt;/<span style="color: #f07178;">div</span>&gt;
    &lt;/<span style="color: #f07178;">div</span>&gt;

    <span style="color: #7c7c7c;">&lt;!-- Identity Verification Iframe --&gt;</span>
    &lt;<span style="color: #f07178;">iframe</span>
      <span style="color: #c792ea;">v-if</span>=<span style="color: #c3e88d;">"!error"</span>
      <span style="color: #c792ea;">ref</span>=<span style="color: #c3e88d;">"identityFrame"</span>
      <span style="color: #c792ea;">:src</span>=<span style="color: #c3e88d;">"embedUrl"</span>
      <span style="color: #c792ea;">width</span>=<span style="color: #c3e88d;">"100%"</span>
      <span style="color: #c792ea;">height</span>=<span style="color: #c3e88d;">"600"</span>
      <span style="color: #c792ea;">frameborder</span>=<span style="color: #c3e88d;">"0"</span>
      <span style="color: #c792ea;">title</span>=<span style="color: #c3e88d;">"Identity Verification"</span>
      <span style="color: #c792ea;">allow</span>=<span style="color: #c3e88d;">"camera; microphone"</span>
      <span style="color: #c792ea;">@load</span>=<span style="color: #c3e88d;">"onIframeLoad"</span>
    &gt;&lt;/<span style="color: #f07178;">iframe</span>&gt;
  &lt;/<span style="color: #f07178;">div</span>&gt;
&lt;/<span style="color: #f07178;">template</span>&gt;

&lt;<span style="color: #f07178;">script</span> <span style="color: #c792ea;">setup</span> <span style="color: #c792ea;">lang</span>=<span style="color: #c3e88d;">"ts"</span>&gt;
<span style="color: #c792ea;">import</span> { <span style="color: #82aaff;">ref</span>, <span style="color: #82aaff;">computed</span>, <span style="color: #82aaff;">onMounted</span>, <span style="color: #82aaff;">onUnmounted</span> } <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'vue'</span>;

<span style="color: #7c7c7c;">// Props interface</span>
<span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">Props</span> {
  <span style="color: #82aaff;">testMode</span>?: <span style="color: #c792ea;">boolean</span>;
  <span style="color: #82aaff;">sessionId</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">baseUrl</span>?: <span style="color: #c792ea;">string</span>;
}

<span style="color: #7c7c7c;">// Identity data interface</span>
<span style="color: #c792ea;">interface</span> <span style="color: #ffcb6b;">IdentityData</span> {
  <span style="color: #82aaff;">firstName</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">lastName</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">idNumber</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">birthDate</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">confidence</span>: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">phone_number</span>?: <span style="color: #c792ea;">string</span>;
  <span style="color: #82aaff;">id_type</span>: <span style="color: #c3e88d;">'national-id'</span> | <span style="color: #c3e88d;">'passport'</span> | <span style="color: #c3e88d;">'umid'</span>;
  <span style="color: #82aaff;">action</span>: <span style="color: #c3e88d;">'success'</span> | <span style="color: #c3e88d;">'cancel'</span>;
}

<span style="color: #7c7c7c;">// Props with defaults</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">props</span> = <span style="color: #82aaff;">withDefaults</span>(<span style="color: #82aaff;">defineProps</span>&lt;<span style="color: #ffcb6b;">Props</span>&gt;(), {
  <span style="color: #82aaff;">testMode</span>: <span style="color: #f78c6c;">false</span>,
  <span style="color: #82aaff;">baseUrl</span>: <span style="color: #c3e88d;">'http://localhost:3000'</span>
});

<span style="color: #7c7c7c;">// Emits</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">emit</span> = <span style="color: #82aaff;">defineEmits</span>&lt;{
  <span style="color: #82aaff;">verificationComplete</span>: [<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>];
  <span style="color: #82aaff;">verificationError</span>: [<span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span>];
  <span style="color: #82aaff;">verificationCancelled</span>: [];
}&gt;();

<span style="color: #7c7c7c;">// Reactive state</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">identityFrame</span> = <span style="color: #82aaff;">ref</span>&lt;<span style="color: #ffcb6b;">HTMLIFrameElement</span> | <span style="color: #c792ea;">null</span>&gt;(<span style="color: #f78c6c;">null</span>);
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">isLoading</span> = <span style="color: #82aaff;">ref</span>(<span style="color: #f78c6c;">true</span>);
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">error</span> = <span style="color: #82aaff;">ref</span>&lt;<span style="color: #c792ea;">string</span> | <span style="color: #c792ea;">null</span>&gt;(<span style="color: #f78c6c;">null</span>);

<span style="color: #7c7c7c;">// Computed embed URL</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">embedUrl</span> = <span style="color: #82aaff;">computed</span>(() => {
  <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">url</span> = <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">URL</span>(<span style="color: #c3e88d;">'/embed'</span>, <span style="color: #82aaff;">props</span>.<span style="color: #82aaff;">baseUrl</span>);
  <span style="color: #82aaff;">url</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'testMode'</span>, <span style="color: #82aaff;">props</span>.<span style="color: #82aaff;">testMode</span>.<span style="color: #82aaff;">toString</span>());
  <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">props</span>.<span style="color: #82aaff;">sessionId</span>) {
    <span style="color: #82aaff;">url</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'sessionId'</span>, <span style="color: #82aaff;">props</span>.<span style="color: #82aaff;">sessionId</span>);
  }
  <span style="color: #c792ea;">return</span> <span style="color: #82aaff;">url</span>.<span style="color: #82aaff;">toString</span>();
});

<span style="color: #7c7c7c;">// Message handler</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleMessage</span> = (<span style="color: #82aaff;">event</span>: <span style="color: #ffcb6b;">MessageEvent</span>) => {
  <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">origin</span> !== <span style="color: #82aaff;">props</span>.<span style="color: #82aaff;">baseUrl</span>) <span style="color: #c792ea;">return</span>;

  <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">type</span>, <span style="color: #82aaff;">data</span> } = <span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">data</span>;

  <span style="color: #c792ea;">switch</span> (<span style="color: #82aaff;">type</span>) {
    <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'IDENTITY_VERIFIED'</span>:
      <span style="color: #82aaff;">isLoading</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">false</span>;
      <span style="color: #82aaff;">error</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">null</span>;
      <span style="color: #82aaff;">emit</span>(<span style="color: #c3e88d;">'verificationComplete'</span>, <span style="color: #82aaff;">data</span>);
      <span style="color: #c792ea;">break</span>;

    <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'VERIFICATION_ERROR'</span>:
      <span style="color: #82aaff;">isLoading</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">false</span>;
      <span style="color: #82aaff;">error</span>.<span style="color: #82aaff;">value</span> = <span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">error</span> || <span style="color: #c3e88d;">'Verification failed'</span>;
      <span style="color: #82aaff;">emit</span>(<span style="color: #c3e88d;">'verificationError'</span>, <span style="color: #82aaff;">error</span>.<span style="color: #82aaff;">value</span>);
      <span style="color: #c792ea;">break</span>;

    <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'USER_CANCELLED'</span>:
      <span style="color: #82aaff;">isLoading</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">false</span>;
      <span style="color: #82aaff;">emit</span>(<span style="color: #c3e88d;">'verificationCancelled'</span>);
      <span style="color: #c792ea;">break</span>;
  }
};

<span style="color: #7c7c7c;">// Iframe load handler</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">onIframeLoad</span> = () => {
  <span style="color: #82aaff;">setTimeout</span>(() => {
    <span style="color: #82aaff;">isLoading</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">false</span>;
  }, <span style="color: #f78c6c;">1000</span>);
};

<span style="color: #7c7c7c;">// Retry function</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">retry</span> = () => {
  <span style="color: #82aaff;">error</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">null</span>;
  <span style="color: #82aaff;">isLoading</span>.<span style="color: #82aaff;">value</span> = <span style="color: #f78c6c;">true</span>;
  <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">identityFrame</span>.<span style="color: #82aaff;">value</span>) {
    <span style="color: #82aaff;">identityFrame</span>.<span style="color: #82aaff;">value</span>.<span style="color: #82aaff;">src</span> = <span style="color: #82aaff;">embedUrl</span>.<span style="color: #82aaff;">value</span>;
  }
};

<span style="color: #7c7c7c;">// Lifecycle</span>
<span style="color: #82aaff;">onMounted</span>(() => {
  <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">addEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #82aaff;">handleMessage</span>);
});

<span style="color: #82aaff;">onUnmounted</span>(() => {
  <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">removeEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #82aaff;">handleMessage</span>);
});
&lt;/<span style="color: #f07178;">script</span>&gt;

&lt;<span style="color: #f07178;">style</span> <span style="color: #c792ea;">scoped</span>&gt;
.<span style="color: #82aaff;">identity-verification</span> {
  <span style="color: #82aaff;">position</span>: <span style="color: #c792ea;">relative</span>;
  <span style="color: #82aaff;">border-radius</span>: <span style="color: #f78c6c;">8px</span>;
  <span style="color: #82aaff;">overflow</span>: <span style="color: #c792ea;">hidden</span>;
  <span style="color: #82aaff;">box-shadow</span>: <span style="color: #f78c6c;">0</span> <span style="color: #f78c6c;">4px</span> <span style="color: #f78c6c;">6px</span> <span style="color: #82aaff;">rgba</span>(<span style="color: #f78c6c;">0</span>, <span style="color: #f78c6c;">0</span>, <span style="color: #f78c6c;">0</span>, <span style="color: #f78c6c;">0.1</span>);
}

.<span style="color: #82aaff;">loading-overlay</span> {
  <span style="color: #82aaff;">position</span>: <span style="color: #c792ea;">absolute</span>;
  <span style="color: #82aaff;">inset</span>: <span style="color: #f78c6c;">0</span>;
  <span style="color: #82aaff;">background</span>: <span style="color: #82aaff;">rgba</span>(<span style="color: #f78c6c;">255</span>, <span style="color: #f78c6c;">255</span>, <span style="color: #f78c6c;">255</span>, <span style="color: #f78c6c;">0.9</span>);
  <span style="color: #82aaff;">display</span>: <span style="color: #c792ea;">flex</span>;
  <span style="color: #82aaff;">align-items</span>: <span style="color: #c792ea;">center</span>;
  <span style="color: #82aaff;">justify-content</span>: <span style="color: #c792ea;">center</span>;
  <span style="color: #82aaff;">z-index</span>: <span style="color: #f78c6c;">10</span>;
}

.<span style="color: #82aaff;">error-state</span> {
  <span style="color: #82aaff;">padding</span>: <span style="color: #f78c6c;">2rem</span>;
  <span style="color: #82aaff;">text-align</span>: <span style="color: #c792ea;">center</span>;
  <span style="color: #82aaff;">background</span>: <span style="color: #c3e88d;">#fef2f2</span>;
  <span style="color: #82aaff;">color</span>: <span style="color: #c3e88d;">#ef4444</span>;
}
&lt;/<span style="color: #f07178;">style</span>&gt;
                </div>

                <h4>Usage in Parent Component:</h4>
                <div class="code-block">
<span style="color: #7c7c7c;">&lt;!-- App.vue --&gt;</span>
&lt;<span style="color: #f07178;">template</span>&gt;
  &lt;<span style="color: #f07178;">div</span>&gt;
    &lt;<span style="color: #f07178;">IdentityVerification</span>
      <span style="color: #c792ea;">:test-mode</span>=<span style="color: #c3e88d;">"false"</span>
      <span style="color: #c792ea;">session-id</span>=<span style="color: #c3e88d;">"user-session-123"</span>
      <span style="color: #c792ea;">@verification-complete</span>=<span style="color: #c3e88d;">"handleSuccess"</span>
      <span style="color: #c792ea;">@verification-error</span>=<span style="color: #c3e88d;">"handleError"</span>
      <span style="color: #c792ea;">@verification-cancelled</span>=<span style="color: #c3e88d;">"handleCancel"</span>
    /&gt;
  &lt;/<span style="color: #f07178;">div</span>&gt;
&lt;/<span style="color: #f07178;">template</span>&gt;

&lt;<span style="color: #f07178;">script</span> <span style="color: #c792ea;">setup</span> <span style="color: #c792ea;">lang</span>=<span style="color: #c3e88d;">"ts"</span>&gt;
<span style="color: #c792ea;">import</span> <span style="color: #82aaff;">IdentityVerification</span> <span style="color: #c792ea;">from</span> <span style="color: #c3e88d;">'./components/IdentityVerification.vue'</span>;

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleSuccess</span> = (<span style="color: #82aaff;">data</span>: <span style="color: #ffcb6b;">IdentityData</span>) => {
  <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'‚úÖ Verification successful:'</span>, <span style="color: #82aaff;">data</span>);
  <span style="color: #7c7c7c;">// Handle success logic here</span>
};

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleError</span> = (<span style="color: #82aaff;">error</span>: <span style="color: #c792ea;">string</span>) => {
  <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'‚ùå Verification error:'</span>, <span style="color: #82aaff;">error</span>);
};

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">handleCancel</span> = () => {
  <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üö´ Verification cancelled'</span>);
};
&lt;/<span style="color: #f07178;">script</span>&gt;
                    </div>
                </div>

                <h3 id="vanilla-example">Vanilla JavaScript (ES6+)</h3>
                <p>Modern JavaScript class with full error handling and state management:</p>
                <div class="code-block with-lines">
                    <div class="line-numbers">
                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                        <div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div>
                        <div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div>
                        <div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div>
                        <div>111</div><div>112</div><div>113</div><div>114</div><div>115</div><div>116</div><div>117</div><div>118</div><div>119</div><div>120</div>
                        <div>121</div><div>122</div><div>123</div><div>124</div><div>125</div><div>126</div><div>127</div><div>128</div><div>129</div><div>130</div>
                        <div>131</div><div>132</div><div>133</div><div>134</div><div>135</div><div>136</div><div>137</div><div>138</div><div>139</div><div>140</div>
                        <div>141</div><div>142</div><div>143</div><div>144</div><div>145</div><div>146</div><div>147</div><div>148</div><div>149</div><div>150</div>
                    </div>
                    <div class="code-content">
<span style="color: #7c7c7c;">/**
 * Identity Verification Widget
 * A complete vanilla JavaScript implementation
 */</span>
<span style="color: #c792ea;">class</span> <span style="color: #ffcb6b;">IdentityVerification</span> {
    <span style="color: #7c7c7c;">/**
     * @param {HTMLElement} container - DOM element to mount the widget
     * @param {Object} options - Configuration options
     * @param {boolean} options.testMode - Enable test mode
     * @param {string} options.sessionId - Session identifier
     * @param {string} options.baseUrl - Base URL for the service
     * @param {Function} options.onResult - Success callback
     * @param {Function} options.onError - Error callback
     * @param {Function} options.onCancel - Cancel callback
     * @param {Function} options.onLoad - Load callback
     */</span>
    <span style="color: #82aaff;">constructor</span>(<span style="color: #82aaff;">container</span>, <span style="color: #82aaff;">options</span> = {}) {
        <span style="color: #7c7c7c;">// Validate container</span>
        <span style="color: #c792ea;">if</span> (!<span style="color: #82aaff;">container</span> || !(<span style="color: #82aaff;">container</span> <span style="color: #c792ea;">instanceof</span> <span style="color: #ffcb6b;">HTMLElement</span>)) {
            <span style="color: #c792ea;">throw</span> <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">Error</span>(<span style="color: #c3e88d;">'Invalid container element provided'</span>);
        }

        <span style="color: #7c7c7c;">// Configuration</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span> = <span style="color: #82aaff;">container</span>;
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span> = {
            <span style="color: #82aaff;">testMode</span>: <span style="color: #f78c6c;">false</span>,
            <span style="color: #82aaff;">baseUrl</span>: <span style="color: #c3e88d;">'http://localhost:3000'</span>,
            <span style="color: #82aaff;">sessionId</span>: <span style="color: #f78c6c;">null</span>,
            <span style="color: #82aaff;">onResult</span>: () => {},
            <span style="color: #82aaff;">onError</span>: () => {},
            <span style="color: #82aaff;">onCancel</span>: () => {},
            <span style="color: #82aaff;">onLoad</span>: () => {},
            ...<span style="color: #82aaff;">options</span>
        };

        <span style="color: #7c7c7c;">// State</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span> = <span style="color: #f78c6c;">null</span>;
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">isLoading</span> = <span style="color: #f78c6c;">true</span>;
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">isDestroyed</span> = <span style="color: #f78c6c;">false</span>;
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">messageHandler</span> = <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">handleMessage</span>.<span style="color: #82aaff;">bind</span>(<span style="color: #c792ea;">this</span>);

        <span style="color: #7c7c7c;">// Initialize</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">init</span>();
    }

    <span style="color: #7c7c7c;">/**
     * Initialize the verification widget
     */</span>
    <span style="color: #82aaff;">init</span>() {
        <span style="color: #c792ea;">try</span> {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">createLoadingIndicator</span>();
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">createIframe</span>();
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">setupEventListeners</span>();
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">mountToContainer</span>();
        } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">handleError</span>(<span style="color: #c3e88d;">`Initialization failed: ${<span style="color: #82aaff;">error</span>.<span style="color: #82aaff;">message</span>}`</span>);
        }
    }

    <span style="color: #7c7c7c;">/**
     * Create loading indicator
     */</span>
    <span style="color: #82aaff;">createLoadingIndicator</span>() {
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">loadingEl</span> = <span style="color: #82aaff;">document</span>.<span style="color: #82aaff;">createElement</span>(<span style="color: #c3e88d;">'div'</span>);
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">loadingEl</span>.<span style="color: #82aaff;">className</span> = <span style="color: #c3e88d;">'identity-loading'</span>;
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">loadingEl</span>.<span style="color: #82aaff;">innerHTML</span> = <span style="color: #c3e88d;">`
            &lt;div style="
                display: flex; 
                align-items: center; 
                justify-content: center; 
                height: 600px; 
                background: #f8fafc; 
                border-radius: 8px;
                flex-direction: column;
                gap: 16px;
            "&gt;
                &lt;div style="
                    font-size: 24px; 
                    animation: spin 2s linear infinite;
                "&gt;üîÑ&lt;/div&gt;
                &lt;div style="color: #6b7280;"&gt;Loading identity verification...&lt;/div&gt;
            &lt;/div&gt;
            &lt;style&gt;
                @keyframes spin {
                    from { transform: rotate(0deg); }
                    to { transform: rotate(360deg); }
                }
            &lt;/style&gt;
        `</span>;
    }

    <span style="color: #7c7c7c;">/**
     * Create and configure iframe
     */</span>
    <span style="color: #82aaff;">createIframe</span>() {
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span> = <span style="color: #82aaff;">document</span>.<span style="color: #82aaff;">createElement</span>(<span style="color: #c3e88d;">'iframe'</span>);
        
        <span style="color: #7c7c7c;">// Build embed URL</span>
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">url</span> = <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">URL</span>(<span style="color: #c3e88d;">'/embed'</span>, <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">baseUrl</span>);
        <span style="color: #82aaff;">url</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'testMode'</span>, <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">testMode</span>.<span style="color: #82aaff;">toString</span>());
        
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">sessionId</span>) {
            <span style="color: #82aaff;">url</span>.<span style="color: #82aaff;">searchParams</span>.<span style="color: #82aaff;">set</span>(<span style="color: #c3e88d;">'sessionId'</span>, <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">sessionId</span>);
        }

        <span style="color: #7c7c7c;">// Configure iframe</span>
        <span style="color: #82aaff;">Object</span>.<span style="color: #82aaff;">assign</span>(<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>, {
            <span style="color: #82aaff;">src</span>: <span style="color: #82aaff;">url</span>.<span style="color: #82aaff;">toString</span>(),
            <span style="color: #82aaff;">width</span>: <span style="color: #c3e88d;">'100%'</span>,
            <span style="color: #82aaff;">height</span>: <span style="color: #c3e88d;">'600'</span>,
            <span style="color: #82aaff;">frameBorder</span>: <span style="color: #c3e88d;">'0'</span>,
            <span style="color: #82aaff;">title</span>: <span style="color: #c3e88d;">'Identity Verification'</span>,
            <span style="color: #82aaff;">allow</span>: <span style="color: #c3e88d;">'camera; microphone'</span>,
        });

        <span style="color: #7c7c7c;">// Hide initially</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">style</span>.<span style="color: #82aaff;">display</span> = <span style="color: #c3e88d;">'none'</span>;
        
        <span style="color: #7c7c7c;">// Handle iframe load</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">onload</span> = () => {
            <span style="color: #82aaff;">setTimeout</span>(() => {
                <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">hideLoading</span>();
                <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">onLoad</span>();
            }, <span style="color: #f78c6c;">500</span>);
        };

        <span style="color: #7c7c7c;">// Handle iframe error</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">onerror</span> = () => {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">handleError</span>(<span style="color: #c3e88d;">'Failed to load verification service'</span>);
        };
    }

    <span style="color: #7c7c7c;">/**
     * Setup event listeners
     */</span>
    <span style="color: #82aaff;">setupEventListeners</span>() {
        <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">addEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">messageHandler</span>);
    }

    <span style="color: #7c7c7c;">/**
     * Mount widget to container
     */</span>
    <span style="color: #82aaff;">mountToContainer</span>() {
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>.<span style="color: #82aaff;">innerHTML</span> = <span style="color: #c3e88d;">''</span>; <span style="color: #7c7c7c;">// Clear container</span>
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>.<span style="color: #82aaff;">appendChild</span>(<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">loadingEl</span>);
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>.<span style="color: #82aaff;">appendChild</span>(<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>);
    }

    <span style="color: #7c7c7c;">/**
     * Hide loading indicator and show iframe
     */</span>
    <span style="color: #82aaff;">hideLoading</span>() {
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">loadingEl</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">loadingEl</span>.<span style="color: #82aaff;">style</span>.<span style="color: #82aaff;">display</span> = <span style="color: #c3e88d;">'none'</span>;
        }
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">style</span>.<span style="color: #82aaff;">display</span> = <span style="color: #c3e88d;">'block'</span>;
        }
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">isLoading</span> = <span style="color: #f78c6c;">false</span>;
    }

    <span style="color: #7c7c7c;">/**
     * Handle postMessage events from iframe
     */</span>
    <span style="color: #82aaff;">handleMessage</span>(<span style="color: #82aaff;">event</span>) {
        <span style="color: #7c7c7c;">// Security check</span>
        <span style="color: #c792ea;">if</span> (<span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">origin</span> !== <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">baseUrl</span>) <span style="color: #c792ea;">return</span>;
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">isDestroyed</span>) <span style="color: #c792ea;">return</span>;

        <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">type</span>, <span style="color: #82aaff;">data</span> } = <span style="color: #82aaff;">event</span>.<span style="color: #82aaff;">data</span> || {};

        <span style="color: #c792ea;">switch</span> (<span style="color: #82aaff;">type</span>) {
            <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'IDENTITY_VERIFIED'</span>:
                <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'‚úÖ Identity verification successful'</span>, <span style="color: #82aaff;">data</span>);
                <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">onResult</span>(<span style="color: #82aaff;">data</span>);
                <span style="color: #c792ea;">break</span>;

            <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'VERIFICATION_ERROR'</span>:
                <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">errorMsg</span> = <span style="color: #82aaff;">data</span>?.<span style="color: #82aaff;">error</span> || <span style="color: #c3e88d;">'Verification failed'</span>;
                <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'‚ùå Identity verification error:'</span>, <span style="color: #82aaff;">errorMsg</span>);
                <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">handleError</span>(<span style="color: #82aaff;">errorMsg</span>);
                <span style="color: #c792ea;">break</span>;

            <span style="color: #c792ea;">case</span> <span style="color: #c3e88d;">'USER_CANCELLED'</span>:
                <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üö´ Identity verification cancelled'</span>);
                <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">onCancel</span>();
                <span style="color: #c792ea;">break</span>;
                
            <span style="color: #c792ea;">default</span>:
                <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üì® Received message:'</span>, <span style="color: #82aaff;">type</span>, <span style="color: #82aaff;">data</span>);
        }
    }

    <span style="color: #7c7c7c;">/**
     * Handle errors
     */</span>
    <span style="color: #82aaff;">handleError</span>(<span style="color: #82aaff;">error</span>) {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'Identity Verification Error:'</span>, <span style="color: #82aaff;">error</span>);
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">options</span>.<span style="color: #82aaff;">onError</span>(<span style="color: #82aaff;">error</span>);
        
        <span style="color: #7c7c7c;">// Show error UI</span>
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>.<span style="color: #82aaff;">innerHTML</span> = <span style="color: #c3e88d;">`
                &lt;div style="
                    padding: 2rem; 
                    text-align: center; 
                    background: #fef2f2; 
                    border: 1px solid #fecaca; 
                    border-radius: 8px;
                    color: #dc2626;
                "&gt;
                    &lt;div style="font-size: 24px; margin-bottom: 8px;"&gt;‚ùå&lt;/div&gt;
                    &lt;div style="font-weight: bold; margin-bottom: 8px;"&gt;Verification Error&lt;/div&gt;
                    &lt;div style="font-size: 14px;"&gt;${<span style="color: #82aaff;">error</span>}&lt;/div&gt;
                &lt;/div&gt;
            `</span>;
        }
    }

    <span style="color: #7c7c7c;">/**
     * Clean up and remove event listeners
     */</span>
    <span style="color: #82aaff;">destroy</span>() {
        <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">isDestroyed</span> = <span style="color: #f78c6c;">true</span>;
        
        <span style="color: #7c7c7c;">// Remove event listeners</span>
        <span style="color: #82aaff;">window</span>.<span style="color: #82aaff;">removeEventListener</span>(<span style="color: #c3e88d;">'message'</span>, <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">messageHandler</span>);
        
        <span style="color: #7c7c7c;">// Clean up DOM</span>
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span> && <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">parentNode</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">parentNode</span>.<span style="color: #82aaff;">removeChild</span>(<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>);
        }
        
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">container</span>.<span style="color: #82aaff;">innerHTML</span> = <span style="color: #c3e88d;">''</span>;
        }
        
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üßπ Identity verification widget destroyed'</span>);
    }

    <span style="color: #7c7c7c;">/**
     * Refresh the verification (reload iframe)
     */</span>
    <span style="color: #82aaff;">refresh</span>() {
        <span style="color: #c792ea;">if</span> (<span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>) {
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">isLoading</span> = <span style="color: #f78c6c;">true</span>;
            <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">src</span> = <span style="color: #c792ea;">this</span>.<span style="color: #82aaff;">iframe</span>.<span style="color: #82aaff;">src</span>; <span style="color: #7c7c7c;">// Trigger reload</span>
        }
    }
}

<span style="color: #7c7c7c;">// ==========================================
// USAGE EXAMPLES
// ==========================================</span>

<span style="color: #7c7c7c;">// Basic usage</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">container</span> = <span style="color: #82aaff;">document</span>.<span style="color: #82aaff;">getElementById</span>(<span style="color: #c3e88d;">'verification-container'</span>);
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">verification</span> = <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">IdentityVerification</span>(<span style="color: #82aaff;">container</span>, {
    <span style="color: #82aaff;">testMode</span>: <span style="color: #f78c6c;">false</span>,
    <span style="color: #82aaff;">sessionId</span>: <span style="color: #c3e88d;">'user-session-123'</span>,
    
    <span style="color: #82aaff;">onResult</span>: (<span style="color: #82aaff;">data</span>) => {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'‚úÖ Verification successful!'</span>, <span style="color: #82aaff;">data</span>);
        <span style="color: #7c7c7c;">// Handle successful verification</span>
        <span style="color: #82aaff;">alert</span>(<span style="color: #c3e88d;">`Welcome, ${<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">firstName</span>} ${<span style="color: #82aaff;">data</span>.<span style="color: #82aaff;">lastName</span>}!`</span>);
    },
    
    <span style="color: #82aaff;">onError</span>: (<span style="color: #82aaff;">error</span>) => {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'‚ùå Verification failed:'</span>, <span style="color: #82aaff;">error</span>);
        <span style="color: #7c7c7c;">// Handle verification error</span>
    },
    
    <span style="color: #82aaff;">onCancel</span>: () => {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üö´ User cancelled verification'</span>);
        <span style="color: #7c7c7c;">// Handle cancellation</span>
    },
    
    <span style="color: #82aaff;">onLoad</span>: () => {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üöÄ Verification widget loaded'</span>);
    }
});

<span style="color: #7c7c7c;">// Clean up when done (important for SPA applications)</span>
<span style="color: #c792ea;">window</span>.<span style="color: #82aaff;">addEventListener</span>(<span style="color: #c3e88d;">'beforeunload'</span>, () => {
    <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">destroy</span>();
});
                    </div>
                </div>

                <h3 id="nodejs-example">Node.js Backend Integration</h3>
                <p>Complete Express.js server with webhook handling and database integration:</p>
                <div class="code-block with-lines">
                    <div class="line-numbers">
                        <div>1</div><div>2</div><div>3</div><div>4</div><div>5</div><div>6</div><div>7</div><div>8</div><div>9</div><div>10</div>
                        <div>11</div><div>12</div><div>13</div><div>14</div><div>15</div><div>16</div><div>17</div><div>18</div><div>19</div><div>20</div>
                        <div>21</div><div>22</div><div>23</div><div>24</div><div>25</div><div>26</div><div>27</div><div>28</div><div>29</div><div>30</div>
                        <div>31</div><div>32</div><div>33</div><div>34</div><div>35</div><div>36</div><div>37</div><div>38</div><div>39</div><div>40</div>
                        <div>41</div><div>42</div><div>43</div><div>44</div><div>45</div><div>46</div><div>47</div><div>48</div><div>49</div><div>50</div>
                        <div>51</div><div>52</div><div>53</div><div>54</div><div>55</div><div>56</div><div>57</div><div>58</div><div>59</div><div>60</div>
                        <div>61</div><div>62</div><div>63</div><div>64</div><div>65</div><div>66</div><div>67</div><div>68</div><div>69</div><div>70</div>
                        <div>71</div><div>72</div><div>73</div><div>74</div><div>75</div><div>76</div><div>77</div><div>78</div><div>79</div><div>80</div>
                        <div>81</div><div>82</div><div>83</div><div>84</div><div>85</div><div>86</div><div>87</div><div>88</div><div>89</div><div>90</div>
                        <div>91</div><div>92</div><div>93</div><div>94</div><div>95</div><div>96</div><div>97</div><div>98</div><div>99</div><div>100</div>
                        <div>101</div><div>102</div><div>103</div><div>104</div><div>105</div><div>106</div><div>107</div><div>108</div><div>109</div><div>110</div>
                        <div>111</div><div>112</div><div>113</div><div>114</div><div>115</div><div>116</div><div>117</div><div>118</div><div>119</div><div>120</div>
                        <div>121</div><div>122</div><div>123</div><div>124</div><div>125</div><div>126</div><div>127</div><div>128</div><div>129</div><div>130</div>
                        <div>131</div><div>132</div><div>133</div><div>134</div><div>135</div><div>136</div><div>137</div><div>138</div><div>139</div><div>140</div>
                        <div>141</div><div>142</div><div>143</div><div>144</div><div>145</div><div>146</div><div>147</div><div>148</div><div>149</div><div>150</div>
                        <div>151</div><div>152</div><div>153</div><div>154</div><div>155</div><div>156</div><div>157</div><div>158</div><div>159</div><div>160</div>
                        <div>161</div><div>162</div><div>163</div><div>164</div><div>165</div><div>166</div><div>167</div><div>168</div><div>169</div><div>170</div>
                        <div>171</div><div>172</div><div>173</div><div>174</div><div>175</div><div>176</div><div>177</div><div>178</div><div>179</div><div>180</div>
                        <div>181</div><div>182</div><div>183</div><div>184</div><div>185</div><div>186</div><div>187</div><div>188</div><div>189</div><div>190</div>
                        <div>191</div><div>192</div><div>193</div><div>194</div><div>195</div><div>196</div><div>197</div><div>198</div><div>199</div><div>200</div>
                        <div>201</div><div>202</div><div>203</div><div>204</div><div>205</div><div>206</div><div>207</div><div>208</div><div>209</div><div>210</div>
                        <div>211</div><div>212</div><div>213</div><div>214</div><div>215</div><div>216</div><div>217</div><div>218</div><div>219</div><div>220</div>
                        <div>221</div><div>222</div><div>223</div><div>224</div><div>225</div><div>226</div><div>227</div><div>228</div><div>229</div><div>230</div>
                        <div>231</div><div>232</div><div>233</div><div>234</div><div>235</div><div>236</div><div>237</div><div>238</div><div>239</div><div>240</div>
                        <div>241</div><div>242</div><div>243</div><div>244</div><div>245</div><div>246</div><div>247</div><div>248</div><div>249</div><div>250</div>
                        <div>251</div><div>252</div><div>253</div><div>254</div><div>255</div><div>256</div><div>257</div><div>258</div><div>259</div><div>260</div>
                        <div>261</div><div>262</div><div>263</div><div>264</div><div>265</div><div>266</div><div>267</div><div>268</div><div>269</div><div>270</div>
                        <div>271</div><div>272</div><div>273</div><div>274</div><div>275</div><div>276</div><div>277</div><div>278</div><div>279</div><div>280</div>
                    </div>
                    <div class="code-content">
<span style="color: #7c7c7c;">// server.js - Complete Node.js backend example</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">express</span> = <span style="color: #82aaff;">require</span>(<span style="color: #c3e88d;">'express'</span>);
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">cors</span> = <span style="color: #82aaff;">require</span>(<span style="color: #c3e88d;">'cors'</span>);
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">helmet</span> = <span style="color: #82aaff;">require</span>(<span style="color: #c3e88d;">'helmet'</span>);
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">rateLimit</span> = <span style="color: #82aaff;">require</span>(<span style="color: #c3e88d;">'express-rate-limit'</span>);
<span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">body</span>, <span style="color: #82aaff;">validationResult</span> } = <span style="color: #82aaff;">require</span>(<span style="color: #c3e88d;">'express-validator'</span>);

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">app</span> = <span style="color: #82aaff;">express</span>();
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">PORT</span> = <span style="color: #82aaff;">process</span>.<span style="color: #82aaff;">env</span>.<span style="color: #82aaff;">PORT</span> || <span style="color: #f78c6c;">8080</span>;

<span style="color: #7c7c7c;">// ==========================================
// MIDDLEWARE SETUP
// ==========================================</span>

<span style="color: #7c7c7c;">// Security middleware</span>
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">use</span>(<span style="color: #82aaff;">helmet</span>());
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">use</span>(<span style="color: #82aaff;">cors</span>({
    <span style="color: #82aaff;">origin</span>: [<span style="color: #c3e88d;">'http://localhost:3000'</span>, <span style="color: #c3e88d;">'https://yourapp.com'</span>],
    <span style="color: #82aaff;">credentials</span>: <span style="color: #f78c6c;">true</span>
}));

<span style="color: #7c7c7c;">// Rate limiting</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">limiter</span> = <span style="color: #82aaff;">rateLimit</span>({
    <span style="color: #82aaff;">windowMs</span>: <span style="color: #f78c6c;">15</span> * <span style="color: #f78c6c;">60</span> * <span style="color: #f78c6c;">1000</span>, <span style="color: #7c7c7c;">// 15 minutes</span>
    <span style="color: #82aaff;">max</span>: <span style="color: #f78c6c;">100</span>, <span style="color: #7c7c7c;">// limit each IP to 100 requests per windowMs</span>
    <span style="color: #82aaff;">message</span>: <span style="color: #c3e88d;">'Too many requests, please try again later.'</span>
});

<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">use</span>(<span style="color: #82aaff;">limiter</span>);
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">use</span>(<span style="color: #82aaff;">express</span>.<span style="color: #82aaff;">json</span>({ <span style="color: #82aaff;">limit</span>: <span style="color: #c3e88d;">'10mb'</span> }));
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">use</span>(<span style="color: #82aaff;">express</span>.<span style="color: #82aaff;">urlencoded</span>({ <span style="color: #82aaff;">extended</span>: <span style="color: #f78c6c;">true</span> }));

<span style="color: #7c7c7c;">// ==========================================
// DATABASE SETUP (Example with MongoDB)
// ==========================================</span>

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">mongoose</span> = <span style="color: #82aaff;">require</span>(<span style="color: #c3e88d;">'mongoose'</span>);

<span style="color: #7c7c7c;">// Identity verification schema</span>
<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">verificationSchema</span> = <span style="color: #c792ea;">new</span> <span style="color: #82aaff;">mongoose</span>.<span style="color: #ffcb6b;">Schema</span>({
    <span style="color: #82aaff;">sessionId</span>: { <span style="color: #82aaff;">type</span>: <span style="color: #ffcb6b;">String</span>, <span style="color: #82aaff;">required</span>: <span style="color: #f78c6c;">true</span>, <span style="color: #82aaff;">unique</span>: <span style="color: #f78c6c;">true</span> },
    <span style="color: #82aaff;">userId</span>: { <span style="color: #82aaff;">type</span>: <span style="color: #ffcb6b;">String</span>, <span style="color: #82aaff;">required</span>: <span style="color: #f78c6c;">true</span> },
    <span style="color: #82aaff;">status</span>: { 
        <span style="color: #82aaff;">type</span>: <span style="color: #ffcb6b;">String</span>, 
        <span style="color: #82aaff;">enum</span>: [<span style="color: #c3e88d;">'pending'</span>, <span style="color: #c3e88d;">'verified'</span>, <span style="color: #c3e88d;">'failed'</span>, <span style="color: #c3e88d;">'cancelled'</span>],
        <span style="color: #82aaff;">default</span>: <span style="color: #c3e88d;">'pending'</span>
    },
    <span style="color: #82aaff;">identityData</span>: {
        <span style="color: #82aaff;">firstName</span>: <span style="color: #ffcb6b;">String</span>,
        <span style="color: #82aaff;">lastName</span>: <span style="color: #ffcb6b;">String</span>,
        <span style="color: #82aaff;">idNumber</span>: <span style="color: #ffcb6b;">String</span>,
        <span style="color: #82aaff;">birthDate</span>: <span style="color: #ffcb6b;">String</span>,
        <span style="color: #82aaff;">confidence</span>: <span style="color: #ffcb6b;">Number</span>
    },
    <span style="color: #82aaff;">metadata</span>: {
        <span style="color: #82aaff;">mode</span>: { <span style="color: #82aaff;">type</span>: <span style="color: #ffcb6b;">String</span>, <span style="color: #82aaff;">enum</span>: [<span style="color: #c3e88d;">'camera'</span>, <span style="color: #c3e88d;">'test'</span>] },
        <span style="color: #82aaff;">ipAddress</span>: <span style="color: #ffcb6b;">String</span>,
        <span style="color: #82aaff;">userAgent</span>: <span style="color: #ffcb6b;">String</span>,
        <span style="color: #82aaff;">processingTime</span>: <span style="color: #ffcb6b;">Number</span>
    },
    <span style="color: #82aaff;">createdAt</span>: { <span style="color: #82aaff;">type</span>: <span style="color: #ffcb6b;">Date</span>, <span style="color: #82aaff;">default</span>: <span style="color: #ffcb6b;">Date</span>.<span style="color: #82aaff;">now</span> },
    <span style="color: #82aaff;">completedAt</span>: <span style="color: #ffcb6b;">Date</span>
});

<span style="color: #c792ea;">const</span> <span style="color: #82aaff;">Verification</span> = <span style="color: #82aaff;">mongoose</span>.<span style="color: #82aaff;">model</span>(<span style="color: #c3e88d;">'Verification'</span>, <span style="color: #82aaff;">verificationSchema</span>);

<span style="color: #7c7c7c;">// ==========================================
// UTILITY FUNCTIONS
// ==========================================</span>

<span style="color: #7c7c7c;">/**
 * Generate unique session ID
 */</span>
<span style="color: #c792ea;">function</span> <span style="color: #82aaff;">generateSessionId</span>() {
    <span style="color: #c792ea;">return</span> <span style="color: #c3e88d;">'session_'</span> + <span style="color: #ffcb6b;">Date</span>.<span style="color: #82aaff;">now</span>() + <span style="color: #c3e88d;">'_'</span> + <span style="color: #ffcb6b;">Math</span>.<span style="color: #82aaff;">random</span>().<span style="color: #82aaff;">toString</span>(<span style="color: #f78c6c;">36</span>).<span style="color: #82aaff;">substr</span>(<span style="color: #f78c6c;">2</span>, <span style="color: #f78c6c;">9</span>);
}

<span style="color: #7c7c7c;">/**
 * Send email notification (placeholder)
 */</span>
<span style="color: #c792ea;">async</span> <span style="color: #c792ea;">function</span> <span style="color: #82aaff;">sendVerificationEmail</span>(<span style="color: #82aaff;">email</span>, <span style="color: #82aaff;">identityData</span>, <span style="color: #82aaff;">status</span>) {
    <span style="color: #7c7c7c;">// Implement your email service (SendGrid, AWS SES, etc.)</span>
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">`üìß Sending ${<span style="color: #82aaff;">status</span>} email to ${<span style="color: #82aaff;">email</span>}`</span>);
    <span style="color: #c792ea;">return</span> { <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">true</span> };
}

<span style="color: #7c7c7c;">/**
 * Process identity verification result
 */</span>
<span style="color: #c792ea;">async</span> <span style="color: #c792ea;">function</span> <span style="color: #82aaff;">processIdentityVerification</span>(<span style="color: #82aaff;">verificationData</span>) {
    <span style="color: #c792ea;">try</span> {
        <span style="color: #c792ea;">const</span> { 
            <span style="color: #82aaff;">sessionId</span>, 
            <span style="color: #82aaff;">userId</span>, 
            <span style="color: #82aaff;">identityData</span>, 
            <span style="color: #82aaff;">metadata</span> 
        } = <span style="color: #82aaff;">verificationData</span>;

        <span style="color: #7c7c7c;">// Update verification record</span>
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">verification</span> = <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">Verification</span>.<span style="color: #82aaff;">findOneAndUpdate</span>(
            { <span style="color: #82aaff;">sessionId</span> },
            {
                <span style="color: #82aaff;">status</span>: <span style="color: #c3e88d;">'verified'</span>,
                <span style="color: #82aaff;">identityData</span>,
                <span style="color: #82aaff;">metadata</span>,
                <span style="color: #82aaff;">completedAt</span>: <span style="color: #c792ea;">new</span> <span style="color: #ffcb6b;">Date</span>()
            },
            { <span style="color: #82aaff;">new</span>: <span style="color: #f78c6c;">true</span>, <span style="color: #82aaff;">upsert</span>: <span style="color: #f78c6c;">true</span> }
        );

        <span style="color: #7c7c7c;">// Send success notification</span>
        <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">sendVerificationEmail</span>(
            <span style="color: #c3e88d;">'user@example.com'</span>, <span style="color: #7c7c7c;">// Get from user record</span>
            <span style="color: #82aaff;">identityData</span>,
            <span style="color: #c3e88d;">'success'</span>
        );

        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'‚úÖ Identity verification processed successfully'</span>, {
            <span style="color: #82aaff;">sessionId</span>,
            <span style="color: #82aaff;">name</span>: <span style="color: #c3e88d;">`${<span style="color: #82aaff;">identityData</span>.<span style="color: #82aaff;">firstName</span>} ${<span style="color: #82aaff;">identityData</span>.<span style="color: #82aaff;">lastName</span>}`</span>
        });

        <span style="color: #c792ea;">return</span> { <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">true</span>, <span style="color: #82aaff;">verification</span> };

    } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'‚ùå Failed to process verification:'</span>, <span style="color: #82aaff;">error</span>);
        <span style="color: #c792ea;">throw</span> <span style="color: #82aaff;">error</span>;
    }
}

<span style="color: #7c7c7c;">// ==========================================
// API ROUTES
// ==========================================</span>

<span style="color: #7c7c7c;">/**
 * Start new verification session
 */</span>
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">post</span>(<span style="color: #c3e88d;">'/api/verification/start'</span>, [
    <span style="color: #82aaff;">body</span>(<span style="color: #c3e88d;">'userId'</span>).<span style="color: #82aaff;">notEmpty</span>().<span style="color: #82aaff;">withMessage</span>(<span style="color: #c3e88d;">'User ID is required'</span>),
    <span style="color: #82aaff;">body</span>(<span style="color: #c3e88d;">'testMode'</span>).<span style="color: #82aaff;">optional</span>().<span style="color: #82aaff;">isBoolean</span>()
], <span style="color: #c792ea;">async</span> (<span style="color: #82aaff;">req</span>, <span style="color: #82aaff;">res</span>) => {
    <span style="color: #c792ea;">try</span> {
        <span style="color: #7c7c7c;">// Validate input</span>
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">errors</span> = <span style="color: #82aaff;">validationResult</span>(<span style="color: #82aaff;">req</span>);
        <span style="color: #c792ea;">if</span> (!<span style="color: #82aaff;">errors</span>.<span style="color: #82aaff;">isEmpty</span>()) {
            <span style="color: #c792ea;">return</span> <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">status</span>(<span style="color: #f78c6c;">400</span>).<span style="color: #82aaff;">json</span>({ 
                <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">false</span>, 
                <span style="color: #82aaff;">errors</span>: <span style="color: #82aaff;">errors</span>.<span style="color: #82aaff;">array</span>() 
            });
        }

        <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">userId</span>, <span style="color: #82aaff;">testMode</span> = <span style="color: #f78c6c;">false</span> } = <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">body</span>;
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">sessionId</span> = <span style="color: #82aaff;">generateSessionId</span>();

        <span style="color: #7c7c7c;">// Create verification record</span>
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">verification</span> = <span style="color: #c792ea;">new</span> <span style="color: #82aaff;">Verification</span>({
            <span style="color: #82aaff;">sessionId</span>,
            <span style="color: #82aaff;">userId</span>,
            <span style="color: #82aaff;">metadata</span>: {
                <span style="color: #82aaff;">mode</span>: <span style="color: #82aaff;">testMode</span> ? <span style="color: #c3e88d;">'test'</span> : <span style="color: #c3e88d;">'camera'</span>,
                <span style="color: #82aaff;">ipAddress</span>: <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">ip</span>,
                <span style="color: #82aaff;">userAgent</span>: <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">get</span>(<span style="color: #c3e88d;">'User-Agent'</span>)
            }
        });

        <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">save</span>();

        <span style="color: #7c7c7c;">// Generate embed URL</span>
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">embedUrl</span> = <span style="color: #c3e88d;">`http://localhost:3000/embed?sessionId=${<span style="color: #82aaff;">sessionId</span>}&testMode=${<span style="color: #82aaff;">testMode</span>}`</span>;

        <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">json</span>({
            <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">true</span>,
            <span style="color: #82aaff;">sessionId</span>,
            <span style="color: #82aaff;">embedUrl</span>,
            <span style="color: #82aaff;">testMode</span>
        });

    } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'Error starting verification:'</span>, <span style="color: #82aaff;">error</span>);
        <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">status</span>(<span style="color: #f78c6c;">500</span>).<span style="color: #82aaff;">json</span>({ 
            <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">false</span>, 
            <span style="color: #82aaff;">error</span>: <span style="color: #c3e88d;">'Internal server error'</span> 
        });
    }
});

<span style="color: #7c7c7c;">/**
 * Webhook endpoint to receive verification results
 */</span>
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">post</span>(<span style="color: #c3e88d;">'/webhook/identity-verified'</span>, [
    <span style="color: #82aaff;">body</span>(<span style="color: #c3e88d;">'sessionId'</span>).<span style="color: #82aaff;">notEmpty</span>(),
    <span style="color: #82aaff;">body</span>(<span style="color: #c3e88d;">'data'</span>).<span style="color: #82aaff;">isObject</span>(),
    <span style="color: #82aaff;">body</span>(<span style="color: #c3e88d;">'data.firstName'</span>).<span style="color: #82aaff;">notEmpty</span>(),
    <span style="color: #82aaff;">body</span>(<span style="color: #c3e88d;">'data.lastName'</span>).<span style="color: #82aaff;">notEmpty</span>()
], <span style="color: #c792ea;">async</span> (<span style="color: #82aaff;">req</span>, <span style="color: #82aaff;">res</span>) => {
    <span style="color: #c792ea;">try</span> {
        <span style="color: #7c7c7c;">// Validate webhook data</span>
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">errors</span> = <span style="color: #82aaff;">validationResult</span>(<span style="color: #82aaff;">req</span>);
        <span style="color: #c792ea;">if</span> (!<span style="color: #82aaff;">errors</span>.<span style="color: #82aaff;">isEmpty</span>()) {
            <span style="color: #c792ea;">return</span> <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">status</span>(<span style="color: #f78c6c;">400</span>).<span style="color: #82aaff;">json</span>({ 
                <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">false</span>, 
                <span style="color: #82aaff;">errors</span>: <span style="color: #82aaff;">errors</span>.<span style="color: #82aaff;">array</span>() 
            });
        }

        <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">sessionId</span>, <span style="color: #82aaff;">data</span>: <span style="color: #82aaff;">identityData</span>, <span style="color: #82aaff;">mode</span> } = <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">body</span>;
        
        <span style="color: #7c7c7c;">// Process the verification</span>
        <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">processIdentityVerification</span>({
            <span style="color: #82aaff;">sessionId</span>,
            <span style="color: #82aaff;">userId</span>: <span style="color: #c3e88d;">'extracted-from-session'</span>, <span style="color: #7c7c7c;">// Get from DB</span>
            <span style="color: #82aaff;">identityData</span>,
            <span style="color: #82aaff;">metadata</span>: {
                <span style="color: #82aaff;">mode</span>: <span style="color: #82aaff;">mode</span> || <span style="color: #c3e88d;">'camera'</span>,
                <span style="color: #82aaff;">processingTime</span>: <span style="color: #ffcb6b;">Date</span>.<span style="color: #82aaff;">now</span>()
            }
        });

        <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">json</span>({ <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">true</span> });

    } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'Webhook error:'</span>, <span style="color: #82aaff;">error</span>);
        <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">status</span>(<span style="color: #f78c6c;">500</span>).<span style="color: #82aaff;">json</span>({ 
            <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">false</span>, 
            <span style="color: #82aaff;">error</span>: <span style="color: #c3e88d;">'Failed to process verification'</span> 
        });
    }
});

<span style="color: #7c7c7c;">/**
 * Get verification status
 */</span>
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">get</span>(<span style="color: #c3e88d;">'/api/verification/:sessionId'</span>, <span style="color: #c792ea;">async</span> (<span style="color: #82aaff;">req</span>, <span style="color: #82aaff;">res</span>) => {
    <span style="color: #c792ea;">try</span> {
        <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">sessionId</span> } = <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">params</span>;
        
        <span style="color: #c792ea;">const</span> <span style="color: #82aaff;">verification</span> = <span style="color: #c792ea;">await</span> <span style="color: #82aaff;">Verification</span>.<span style="color: #82aaff;">findOne</span>({ <span style="color: #82aaff;">sessionId</span> });
        
        <span style="color: #c792ea;">if</span> (!<span style="color: #82aaff;">verification</span>) {
            <span style="color: #c792ea;">return</span> <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">status</span>(<span style="color: #f78c6c;">404</span>).<span style="color: #82aaff;">json</span>({ 
                <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">false</span>, 
                <span style="color: #82aaff;">error</span>: <span style="color: #c3e88d;">'Session not found'</span> 
            });
        }

        <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">json</span>({
            <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">true</span>,
            <span style="color: #82aaff;">verification</span>: {
                <span style="color: #82aaff;">sessionId</span>: <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">sessionId</span>,
                <span style="color: #82aaff;">status</span>: <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">status</span>,
                <span style="color: #82aaff;">identityData</span>: <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">identityData</span>,
                <span style="color: #82aaff;">createdAt</span>: <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">createdAt</span>,
                <span style="color: #82aaff;">completedAt</span>: <span style="color: #82aaff;">verification</span>.<span style="color: #82aaff;">completedAt</span>
            }
        });

    } <span style="color: #c792ea;">catch</span> (<span style="color: #82aaff;">error</span>) {
        <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'Error fetching verification:'</span>, <span style="color: #82aaff;">error</span>);
        <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">status</span>(<span style="color: #f78c6c;">500</span>).<span style="color: #82aaff;">json</span>({ 
            <span style="color: #82aaff;">success</span>: <span style="color: #f78c6c;">false</span>, 
            <span style="color: #82aaff;">error</span>: <span style="color: #c3e88d;">'Internal server error'</span> 
        });
    }
});

<span style="color: #7c7c7c;">/**
 * Serve verification page with embedded iframe
 */</span>
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">get</span>(<span style="color: #c3e88d;">'/verify/:userId?'</span>, (<span style="color: #82aaff;">req</span>, <span style="color: #82aaff;">res</span>) => {
    <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">userId</span> = <span style="color: #c3e88d;">'anonymous'</span> } = <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">params</span>;
    <span style="color: #c792ea;">const</span> { <span style="color: #82aaff;">testMode</span> = <span style="color: #c3e88d;">'false'</span> } = <span style="color: #82aaff;">req</span>.<span style="color: #82aaff;">query</span>;
    
    <span style="color: #82aaff;">res</span>.<span style="color: #82aaff;">send</span>(<span style="color: #c3e88d;">`
        &lt;!DOCTYPE html&gt;
        &lt;html lang="en"&gt;
        &lt;head&gt;
            &lt;meta charset="UTF-8"&gt;
            &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
            &lt;title&gt;Identity Verification&lt;/title&gt;
            &lt;style&gt;
                * { margin: 0; padding: 0; box-sizing: border-box; }
                body { font-family: Arial, sans-serif; background: #f5f5f5; padding: 20px; }
                .container { max-width: 1000px; margin: 0 auto; }
                .header { text-align: center; margin-bottom: 20px; }
                .iframe-container { 
                    background: white; 
                    border-radius: 12px; 
                    box-shadow: 0 4px 12px rgba(0,0,0,0.15); 
                    overflow: hidden; 
                }
                .status { 
                    padding: 15px; 
                    background: #e8f5e8; 
                    margin-bottom: 20px; 
                    border-radius: 6px; 
                }
            &lt;/style&gt;
        &lt;/head&gt;
        &lt;body&gt;
            &lt;div class="container"&gt;
                &lt;div class="header"&gt;
                    &lt;h1&gt;üÜî Identity Verification&lt;/h1&gt;
                    &lt;p&gt;User ID: ${<span style="color: #82aaff;">userId</span>} | Mode: ${<span style="color: #82aaff;">testMode</span> === <span style="color: #c3e88d;">'true'</span> ? <span style="color: #c3e88d;">'Test'</span> : <span style="color: #c3e88d;">'Camera'</span>}&lt;/p&gt;
                &lt;/div&gt;
                
                &lt;div class="status" id="status"&gt;
                    üîÑ Initializing verification...
                &lt;/div&gt;
                
                &lt;div class="iframe-container"&gt;
                    &lt;iframe 
                        src="http://localhost:3000/embed?testMode=${<span style="color: #82aaff;">testMode</span>}" 
                        width="100%" 
                        height="600"
                        frameborder="0"
                        allow="camera; microphone"
                        title="Identity Verification"&gt;
                    &lt;/iframe&gt;
                &lt;/div&gt;
            &lt;/div&gt;
            
            &lt;script&gt;
                // Listen for verification results
                window.addEventListener('message', function(event) {
                    if (event.origin !== 'http://localhost:3000') return;
                    
                    const status = document.getElementById('status');
                    
                    switch(event.data.type) {
                        case 'IDENTITY_VERIFIED':
                            status.innerHTML = '‚úÖ Verification successful! Welcome, ' + 
                                event.data.data.firstName + ' ' + event.data.data.lastName;
                            status.style.background = '#e8f5e8';
                            break;
                        case 'VERIFICATION_ERROR':
                            status.innerHTML = '‚ùå Verification failed: ' + event.data.error;
                            status.style.background = '#ffeaea';
                            break;
                        case 'USER_CANCELLED':
                            status.innerHTML = 'üö´ Verification cancelled by user';
                            status.style.background = '#fff4e6';
                            break;
                    }
                });
            &lt;/script&gt;
        &lt;/body&gt;
        &lt;/html&gt;
    `</span>);
});

<span style="color: #7c7c7c;">// ==========================================
// SERVER STARTUP
// ==========================================</span>

<span style="color: #7c7c7c;">// Connect to MongoDB</span>
<span style="color: #82aaff;">mongoose</span>.<span style="color: #82aaff;">connect</span>(<span style="color: #82aaff;">process</span>.<span style="color: #82aaff;">env</span>.<span style="color: #82aaff;">MONGODB_URI</span> || <span style="color: #c3e88d;">'mongodb://localhost:27017/identity-verification'</span>)
    .<span style="color: #82aaff;">then</span>(() => <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">'üì¶ Connected to MongoDB'</span>))
    .<span style="color: #82aaff;">catch</span>(<span style="color: #82aaff;">err</span> => <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">error</span>(<span style="color: #c3e88d;">'‚ùå MongoDB connection error:'</span>, <span style="color: #82aaff;">err</span>));

<span style="color: #7c7c7c;">// Start server</span>
<span style="color: #82aaff;">app</span>.<span style="color: #82aaff;">listen</span>(<span style="color: #82aaff;">PORT</span>, () => {
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">`üöÄ Server running on http://localhost:${<span style="color: #82aaff;">PORT</span>}`</span>);
    <span style="color: #82aaff;">console</span>.<span style="color: #82aaff;">log</span>(<span style="color: #c3e88d;">`üìã Visit http://localhost:${<span style="color: #82aaff;">PORT</span>}/verify to test verification`</span>);
});
                    </div>
                </div>
            </div>
        </div>
        </div>
        
        <!-- Right Sidebar Navigation -->
        <div class="sidebar">
            <h4>üìã Navigation</h4>
            <ul class="sidebar-nav">
                <li><a href="#" onclick="scrollToSection('demo')" class="section">üöÄ Live Demo</a></li>
                
                <li><a href="#" onclick="scrollToSection('api')" class="section">üìö API Documentation</a></li>
                <li><a href="#" onclick="scrollToSection('api-endpoints')" class="subsection">API Endpoints</a></li>
                <li><a href="#" onclick="scrollToSection('api-parameters')" class="subsection">Parameters</a></li>
                <li><a href="#" onclick="scrollToSection('api-responses')" class="subsection">Response Format</a></li>
                
                <li><a href="#" onclick="scrollToSection('integration')" class="section">üîß Integration Guide</a></li>
                <li><a href="#" onclick="scrollToSection('quick-start')" class="subsection">Quick Start</a></li>
                <li><a href="#" onclick="scrollToSection('iframe-embedding')" class="subsection">Iframe Embedding</a></li>
                <li><a href="#" onclick="scrollToSection('postmessage-api')" class="subsection">PostMessage API</a></li>
                
                <li><a href="#" onclick="scrollToSection('examples')" class="section">üíª Code Examples</a></li>
                <li><a href="#" onclick="scrollToSection('react-example')" class="subsection">React Integration</a>
                    <ul class="subsections">
                        <li><a href="#" onclick="scrollToSection('react-basic-component')" class="sub-subsection">Basic Component</a></li>
                        <li><a href="#" onclick="scrollToSection('react-custom-hook')" class="sub-subsection">Custom Hook</a></li>
                        <li><a href="#" onclick="scrollToSection('react-usage-example')" class="sub-subsection">Usage Example</a></li>
                    </ul>
                </li>
                <li><a href="#" onclick="scrollToSection('vue-example')" class="subsection">Vue.js 3 Integration</a></li>
                <li><a href="#" onclick="scrollToSection('vanilla-example')" class="subsection">Vanilla JavaScript</a></li>
                <li><a href="#" onclick="scrollToSection('nodejs-example')" class="subsection">Node.js Backend</a></li>
            </ul>
            
            <h4 style="margin-top: 20px;">üîÑ Auto-scroll</h4>
            <label style="display: flex; align-items: center; gap: 6px; font-size: 12px;">
                <input type="checkbox" id="autoScrollSidebar" checked>
                Follow current section
            </label>
        </div>
    </div>

    <script src="/js/embed-demo.js"></script>
    <script>
        // Sidebar navigation functionality
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                // Check if the section is in a different tab
                const tabContent = element.closest('.tab-content');
                if (tabContent && !tabContent.classList.contains('active')) {
                    const tabId = tabContent.id.replace('-tab', '');
                    showTab(tabId);
                }
                
                // Smooth scroll to the element
                element.scrollIntoView({ 
                    behavior: 'smooth', 
                    block: 'start' 
                });
                
                // Update sidebar active state
                updateSidebarActiveState(sectionId);
            }
        }
        
        function updateSidebarActiveState(activeId) {
            // Remove active class from all sidebar links
            const sidebarLinks = document.querySelectorAll('.sidebar-nav a');
            sidebarLinks.forEach(link => link.classList.remove('active'));
            
            // Add active class to current link
            const activeLink = document.querySelector(`[onclick="scrollToSection('${activeId}')"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }
        
        // Auto-scroll functionality to highlight current section
        function checkCurrentSection() {
            if (!document.getElementById('autoScrollSidebar').checked) return;
            
            const sections = [
                'demo', 'api', 'api-endpoints', 'api-parameters', 'api-responses',
                'integration', 'quick-start', 'iframe-embedding', 'postmessage-api',
                'examples', 'react-example', 'react-basic-component', 'react-custom-hook', 'react-usage-example', 
                'vue-example', 'vanilla-example', 'nodejs-example'
            ];
            
            let currentSection = null;
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            sections.forEach(sectionId => {
                const element = document.getElementById(sectionId);
                if (element && element.offsetParent !== null) { // Check if element is visible
                    const rect = element.getBoundingClientRect();
                    const elementTop = rect.top + scrollTop;
                    
                    // If section is in viewport (with some offset)
                    if (elementTop <= scrollTop + 100) {
                        currentSection = sectionId;
                    }
                }
            });
            
            if (currentSection) {
                updateSidebarActiveState(currentSection);
            }
        }
        
        // Throttle scroll events for performance
        let scrollTimeout;
        window.addEventListener('scroll', () => {
            if (scrollTimeout) {
                clearTimeout(scrollTimeout);
            }
            scrollTimeout = setTimeout(checkCurrentSection, 100);
        });
        
        // Initial check
        setTimeout(checkCurrentSection, 1000);

        // Tab switching functionality
        function showTab(tabName) {
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            const navTabs = document.querySelectorAll('.nav-tab');
            navTabs.forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked nav tab
            event.target.classList.add('active');
        }
        
        // Live API monitoring functionality
        let apiRequestCount = 0;
        let apiResponseCount = 0;
        let currentPayload = {};
        
        // Dynamic payload generation based on form inputs
        function generateCurrentPayload() {
            const frontendBase = document.getElementById('frontendBase')?.value?.trim() || '';
            const idType = document.getElementById('demoIdType')?.value || 'national-id';
            const testModeValue = document.getElementById('testModeSelect')?.value || 'camera';
            const successWebhook = document.getElementById('successWebhook')?.value?.trim() || '';
            const cancelWebhook = document.getElementById('cancelWebhook')?.value?.trim() || '';
            
            const testMode = testModeValue === 'test';
            
            // Always start with default payload structure
            const payload = {
                testMode: testMode
            };
            
            // Add optional values if provided
            if (frontendBase) payload.frontendBase = frontendBase;
            if (idType && idType !== 'national-id') payload.idType = idType; // Only add if not default
            if (successWebhook) payload.successWebhook = successWebhook;
            if (cancelWebhook) payload.cancelWebhook = cancelWebhook;
            
            currentPayload = payload;
            return payload;
        }

        // Generate default payload for initial display
        function getDefaultPayload() {
            return {
                testMode: false
            };
        }
        
        function updateDynamicPayload(isInitial = false) {
            const payload = isInitial ? getDefaultPayload() : generateCurrentPayload();
            const payloadElement = document.getElementById('dynamicPayload');
            
            if (payloadElement) {
                const jsonString = JSON.stringify(payload, null, 2);
                const timestamp = new Date().toLocaleTimeString();
                
                // Add visual feedback for update (skip animation for initial load)
                if (!isInitial) {
                    payloadElement.style.transition = 'all 0.3s ease';
                    payloadElement.style.background = '#065f46';
                }
                
                const updateLabel = isInitial ? 'Default' : 'Live Update';
                const statusEmoji = isInitial ? 'üéØ' : 'üîÑ';
                
                payloadElement.innerHTML = `
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                        <div style="color: #10b981; font-weight: bold;">POST /api/verify/create</div>
                        <div style="color: #9ca3af; font-size: 11px;">${statusEmoji} ${updateLabel}: ${timestamp}</div>
                    </div>
                    <div style="color: #e5e7eb; line-height: 1.4;">${jsonString}</div>
                    <div style="margin-top: 8px; padding-top: 8px; border-top: 1px solid #374151;">
                        <div style="color: #9ca3af; font-size: 11px;">
                            üìä Payload size: ${JSON.stringify(payload).length} bytes | 
                            üîß Properties: ${Object.keys(payload).length} | 
                            üß™ Test mode: ${payload.testMode ? 'ON' : 'OFF'}
                            ${isInitial ? ' | ‚ö†Ô∏è Change form values to see live updates' : ''}
                        </div>
                    </div>
                `;
                
                // Reset background after animation (skip for initial)
                if (!isInitial) {
                    setTimeout(() => {
                        payloadElement.style.background = '#1f2937';
                    }, 300);
                }
            }
        }
        
        function copyCurrentPayload() {
            const payload = generateCurrentPayload();
            const jsonString = JSON.stringify(payload, null, 2);
            
            navigator.clipboard.writeText(jsonString).then(() => {
                const copyBtn = document.getElementById('copyPayload');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copied!';
                copyBtn.style.background = '#10b981';
                
                setTimeout(() => {
                    copyBtn.textContent = originalText;
                    copyBtn.style.background = '';
                }, 2000);
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = jsonString;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const copyBtn = document.getElementById('copyPayload');
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copied!';
                setTimeout(() => copyBtn.textContent = originalText, 2000);
            });
        }
        
        function generateCurlCommand() {
            const payload = generateCurrentPayload();
            const jsonString = JSON.stringify(payload);
            const baseUrl = window.location.origin;
            
            return `curl -X POST "${baseUrl}/api/verify/create" \\
  -H "Content-Type: application/json" \\
  -d '${jsonString}'`;
        }
        
        function toggleCurlCommand() {
            const curlElement = document.getElementById('curlCommand');
            const isVisible = curlElement.style.display !== 'none';
            
            if (isVisible) {
                curlElement.style.display = 'none';
                event.target.textContent = 'üîß Show cURL';
            } else {
                const curlCmd = generateCurlCommand();
                curlElement.innerHTML = `
                    <div style="color: #f59e0b; margin-bottom: 4px; display: flex; justify-content: space-between; align-items: center;">
                        <span>cURL Command</span>
                        <button onclick="copyCurlCommand()" style="font-size: 10px; padding: 2px 6px; background: #059669; border: none; color: white; border-radius: 3px; cursor: pointer;">
                            Copy cURL
                        </button>
                    </div>
                    <div style="color: #e5e7eb; font-family: monospace; white-space: pre-wrap; word-break: break-all;">${curlCmd}</div>
                `;
                curlElement.style.display = 'block';
                event.target.textContent = '‚ùå Hide cURL';
            }
        }
        
        function copyCurlCommand() {
            const curlCmd = generateCurlCommand();
            
            navigator.clipboard.writeText(curlCmd).then(() => {
                const copyBtn = event.target;
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copied!';
                setTimeout(() => copyBtn.textContent = originalText, 2000);
            }).catch(() => {
                // Fallback
                const textArea = document.createElement('textarea');
                textArea.value = curlCmd;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                
                const copyBtn = event.target;
                const originalText = copyBtn.textContent;
                copyBtn.textContent = '‚úÖ Copied!';
                setTimeout(() => copyBtn.textContent = originalText, 2000);
            });
        }

        // Payload examples functionality
        function showPayloadExamples() {
            const examples = [
                {
                    name: "Basic Camera Mode",
                    description: "Minimal payload for camera-based verification",
                    payload: { testMode: false }
                },
                {
                    name: "Test Mode Only", 
                    description: "Skip camera, use test authorization flow",
                    payload: { testMode: true }
                },
                {
                    name: "Passport + Test Mode",
                    description: "Test mode with passport document type",
                    payload: { testMode: true, idType: "passport" }
                },
                {
                    name: "Production Setup",
                    description: "Full configuration with webhooks",
                    payload: { 
                        testMode: false, 
                        idType: "national-id",
                        successWebhook: "https://api.yourapp.com/webhook/success",
                        cancelWebhook: "https://api.yourapp.com/webhook/cancel"
                    }
                },
                {
                    name: "Development with Frontend",
                    description: "Local development with custom frontend base",
                    payload: {
                        testMode: true,
                        frontendBase: "http://localhost:5173",
                        idType: "umid"
                    }
                }
            ];

            let modalHtml = `
                <div id="examplesModal" style="position: fixed; inset: 0; background: rgba(0,0,0,0.8); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;">
                    <div style="background: white; border-radius: 12px; max-width: 800px; width: 100%; max-height: 80vh; overflow-y: auto; padding: 24px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #e5e7eb; padding-bottom: 16px;">
                            <h3 style="margin: 0; color: #1f2937;">üìö Payload Examples</h3>
                            <button onclick="closeExamplesModal()" style="background: #ef4444; border: none; color: white; width: 30px; height: 30px; border-radius: 50%; cursor: pointer; font-size: 16px;">‚úï</button>
                        </div>
                        <div style="display: grid; gap: 16px;">
            `;

            examples.forEach((example, index) => {
                modalHtml += `
                    <div style="border: 1px solid #d1d5db; border-radius: 8px; padding: 16px; background: #f9fafb;">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 8px;">
                            <div>
                                <h4 style="margin: 0 0 4px 0; color: #1d4ed8;">${example.name}</h4>
                                <p style="margin: 0; color: #6b7280; font-size: 14px;">${example.description}</p>
                            </div>
                            <button onclick="usePayloadExample(${index})" style="background: #10b981; border: none; color: white; padding: 6px 12px; border-radius: 4px; cursor: pointer; font-size: 12px; white-space: nowrap; margin-left: 12px;">
                                Use This
                            </button>
                        </div>
                        <div style="background: #1f2937; color: #e5e7eb; padding: 12px; border-radius: 6px; font-family: monospace; font-size: 13px; overflow-x: auto;">
                            ${JSON.stringify(example.payload, null, 2)}
                        </div>
                    </div>
                `;
            });

            modalHtml += `
                        </div>
                        <div style="margin-top: 20px; padding-top: 16px; border-top: 1px solid #e5e7eb; text-align: center;">
                            <button onclick="closeExamplesModal()" style="background: #6b7280; border: none; color: white; padding: 8px 16px; border-radius: 6px; cursor: pointer;">
                                Close
                            </button>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Store examples in global scope for use
            window.payloadExamples = examples;
        }

        function usePayloadExample(index) {
            const example = window.payloadExamples[index];
            const payload = example.payload;
            
            // Set form values based on example payload
            if (payload.frontendBase) {
                document.getElementById('frontendBase').value = payload.frontendBase;
            } else {
                document.getElementById('frontendBase').value = '';
            }
            
            if (payload.idType) {
                document.getElementById('demoIdType').value = payload.idType;
            } else {
                document.getElementById('demoIdType').value = 'national-id';
            }
            
            document.getElementById('testModeSelect').value = payload.testMode ? 'test' : 'camera';
            
            if (payload.successWebhook) {
                document.getElementById('successWebhook').value = payload.successWebhook;
            } else {
                document.getElementById('successWebhook').value = '';
            }
            
            if (payload.cancelWebhook) {
                document.getElementById('cancelWebhook').value = payload.cancelWebhook;
            } else {
                document.getElementById('cancelWebhook').value = '';
            }
            
            // Update the payload display
            updateDynamicPayload(false);
            
            // Close the modal
            closeExamplesModal();
            
            // Show success message
            const exampleBtn = document.querySelector('button[onclick="showPayloadExamples()"]');
            const originalText = exampleBtn.textContent;
            exampleBtn.textContent = '‚úÖ Applied!';
            exampleBtn.style.background = '#10b981';
            setTimeout(() => {
                exampleBtn.textContent = originalText;
                exampleBtn.style.background = '#8b5cf6';
            }, 2000);
        }

        function closeExamplesModal() {
            const modal = document.getElementById('examplesModal');
            if (modal) {
                modal.remove();
            }
        }
        
        function logApiRequest(method, url, data = null) {
            apiRequestCount++;
            const timestamp = new Date().toLocaleTimeString();
            const requestElement = document.getElementById('liveRequests');
            
            // Clear placeholder text if this is first request
            if (apiRequestCount === 1) {
                requestElement.innerHTML = '';
            }
            
            const requestHtml = `
                <div style="border-bottom: 1px solid #374151; padding: 8px 0; margin-bottom: 8px;">
                    <div style="color: #10b981; font-weight: bold;">[${timestamp}] ${method} ${url}</div>
                    ${data ? `<div style="color: #e5e7eb; margin-top: 4px; padding-left: 12px;">${JSON.stringify(data, null, 2)}</div>` : ''}
                </div>
            `;
            
            requestElement.innerHTML += requestHtml;
            
            if (document.getElementById('autoScroll').checked) {
                requestElement.scrollTop = requestElement.scrollHeight;
            }
        }
        
        function logApiResponse(status, data, error = null) {
            apiResponseCount++;
            const timestamp = new Date().toLocaleTimeString();
            const responseElement = document.getElementById('liveResponses');
            
            // Clear placeholder text if this is first response
            if (apiResponseCount === 1) {
                responseElement.innerHTML = '';
            }
            
            const statusColor = status >= 200 && status < 300 ? '#10b981' : '#ef4444';
            const responseHtml = `
                <div style="border-bottom: 1px solid #374151; padding: 8px 0; margin-bottom: 8px;">
                    <div style="color: ${statusColor}; font-weight: bold;">[${timestamp}] Status: ${status}</div>
                    ${error ? 
                        `<div style="color: #ef4444; margin-top: 4px; padding-left: 12px;">Error: ${error}</div>` :
                        `<div style="color: #e5e7eb; margin-top: 4px; padding-left: 12px;">${JSON.stringify(data, null, 2)}</div>`
                    }
                </div>
            `;
            
            responseElement.innerHTML += responseHtml;
            
            if (document.getElementById('autoScroll').checked) {
                responseElement.scrollTop = responseElement.scrollHeight;
            }
        }
        
        function clearApiLogs() {
            document.getElementById('liveRequests').innerHTML = '<div style="color: #9ca3af; font-style: italic;">Logs cleared - new requests will appear here</div>';
            document.getElementById('liveResponses').innerHTML = '<div style="color: #9ca3af; font-style: italic;">Logs cleared - new responses will appear here</div>';
            apiRequestCount = 0;
            apiResponseCount = 0;
        }
        
        // Monitor iframe messages for API activity
        function monitorIframeActivity() {
            const originalPostMessage = window.addEventListener;
            
            // Listen for postMessages from the iframe
            window.addEventListener('message', function(event) {
                if (event.origin !== window.location.origin && event.origin !== 'http://localhost:3000') return;
                
                const timestamp = new Date().toLocaleTimeString();
                
                // Log postMessage communication
                if (event.data && event.data.type) {
                    logApiResponse(200, {
                        type: 'PostMessage',
                        messageType: event.data.type,
                        data: event.data
                    });
                }
            });
        }
        
        // Intercept fetch requests to monitor API calls
        function interceptFetchRequests() {
            const originalFetch = window.fetch;
            
            window.fetch = function(url, options = {}) {
                const method = options.method || 'GET';
                const requestData = options.body ? JSON.parse(options.body) : null;
                
                logApiRequest(method, url, requestData);
                
                return originalFetch(url, options)
                    .then(response => {
                        // Clone response to read it without consuming the original
                        const responseClone = response.clone();
                        
                        responseClone.json()
                            .then(data => {
                                logApiResponse(response.status, data);
                            })
                            .catch(() => {
                                // If not JSON, log as text
                                responseClone.text().then(text => {
                                    logApiResponse(response.status, { responseText: text });
                                });
                            });
                        
                        return response;
                    })
                    .catch(error => {
                        logApiResponse(0, null, error.message);
                        throw error;
                    });
            };
        }
        
        // Add event listeners for form changes
        function setupFormListeners() {
            const formElements = [
                'frontendBase',
                'demoIdType', 
                'testModeSelect',
                'successWebhook',
                'cancelWebhook'
            ];
            
            formElements.forEach(elementId => {
                const element = document.getElementById(elementId);
                if (element) {
                    // Add event listeners for real-time updates
                    element.addEventListener('input', () => updateDynamicPayload(false));
                    element.addEventListener('change', () => updateDynamicPayload(false));
                    element.addEventListener('keyup', () => updateDynamicPayload(false));
                    element.addEventListener('paste', () => {
                        // Small delay for paste events to register
                        setTimeout(() => updateDynamicPayload(false), 10);
                    });
                }
            });
        }
        
        // Initialize demo tab as active on page load
        document.addEventListener('DOMContentLoaded', function() {
            showTab('demo');
            monitorIframeActivity();
            interceptFetchRequests();
            setupFormListeners();
            
            // Show default payload immediately
            updateDynamicPayload(true);
            
            // Log initial demo setup
            setTimeout(() => {
                logApiRequest('GET', '/embed-demo.html', null);
                logApiResponse(200, { message: 'Demo page loaded successfully', defaultPayload: getDefaultPayload() });
            }, 500);
        });
    </script>
</body>

</html>